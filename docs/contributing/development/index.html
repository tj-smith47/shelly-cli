<!doctype html><html lang=en-US data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://tj-smith47.github.io/shelly-cli/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://tj-smith47.github.io/shelly-cli/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://tj-smith47.github.io/shelly-cli/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/shelly-cli/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/shelly-cli/main.22ef554b5895fe0705d54338897f07fc6ad584b08fe77e6f1b2f6355f5b37a5527eaffc940a889adde2597d8113aa226af9d94b93eb00db8a7c7c4a0d7860c7f.css" integrity="sha512-Iu9VS1iV/gcF1UM4iX8H/GrVhLCP535vGy9jVfWzelUn6v/JQKiJrd4ll9gROqImr52UuT6wDbinx8Sg14YMfw==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://tj-smith47.github.io/shelly-cli/docs/contributing/development/><link rel=canonical href=https://tj-smith47.github.io/shelly-cli/docs/contributing/development/><title>Development Guide | Shelly CLI</title><meta name=description content="Set up your development environment for contributing"><link rel=icon href=/shelly-cli/favicon.ico sizes=32x32><link rel=apple-touch-icon href=/shelly-cli/shelly-cli/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/shelly-cli/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/shelly-cli/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/shelly-cli/manifest.webmanifest><meta property="og:url" content="https://tj-smith47.github.io/shelly-cli/docs/contributing/development/"><meta property="og:site_name" content="Shelly CLI"><meta property="og:title" content="Development Guide"><meta property="og:description" content="Set up your development environment for contributing"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2026-01-01T04:31:32+00:00"><meta property="og:image" content="https://tj-smith47.github.io/shelly-cli/images/og-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tj-smith47.github.io/shelly-cli/images/og-image.png"><meta name=twitter:title content="Development Guide"><meta name=twitter:description content="Set up your development environment for contributing"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://tj-smith47.github.io/shelly-cli/","name":"Shelly CLI","position":1},{"@type":"ListItem","item":"https://tj-smith47.github.io/shelly-cli/docs/","name":"Documentation","position":2},{"@type":"ListItem","item":"https://tj-smith47.github.io/shelly-cli/docs/contributing/","name":"Contributing","position":3},{"@type":"ListItem","name":"Development Guide","position":4}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/shelly-cli/>Shelly CLI</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu">
<svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/getting-started/installation/>Installation</a></li><li><a href=/shelly-cli/docs/getting-started/quickstart/>Quick Start</a></li><li><a href=/shelly-cli/docs/getting-started/first-device/>Adding Your First Device</a></li></ul></details></li><li><details><summary>Command Reference</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/shelly/>shelly shelly</a></li><li><details><summary>shelly action</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/action/clear/>shelly action clear</a></li><li><a href=/shelly-cli/docs/commands/action/list/>shelly action list</a></li><li><a href=/shelly-cli/docs/commands/action/set/>shelly action set</a></li><li><a href=/shelly-cli/docs/commands/action/test/>shelly action test</a></li></ul></details></li><li><details><summary>shelly alert</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/alert/create/>shelly alert create</a></li><li><a href=/shelly-cli/docs/commands/alert/list/>shelly alert list</a></li><li><a href=/shelly-cli/docs/commands/alert/snooze/>shelly alert snooze</a></li><li><a href=/shelly-cli/docs/commands/alert/test/>shelly alert test</a></li><li><a href=/shelly-cli/docs/commands/alert/watch/>shelly alert watch</a></li></ul></details></li><li><details><summary>shelly alias</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/alias/delete/>shelly alias delete</a></li><li><a href=/shelly-cli/docs/commands/alias/export/>shelly alias export</a></li><li><a href=/shelly-cli/docs/commands/alias/import/>shelly alias import</a></li><li><a href=/shelly-cli/docs/commands/alias/list/>shelly alias list</a></li><li><a href=/shelly-cli/docs/commands/alias/set/>shelly alias set</a></li></ul></details></li><li><details><summary>shelly api</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/api/methods/>shelly api methods</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/audit/>shelly audit</a></li><li><details><summary>shelly auth</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/auth/disable/>shelly auth disable</a></li><li><a href=/shelly-cli/docs/commands/auth/export/>shelly auth export</a></li><li><a href=/shelly-cli/docs/commands/auth/import/>shelly auth import</a></li><li><a href=/shelly-cli/docs/commands/auth/rotate/>shelly auth rotate</a></li><li><a href=/shelly-cli/docs/commands/auth/set/>shelly auth set</a></li><li><a href=/shelly-cli/docs/commands/auth/status/>shelly auth status</a></li><li><a href=/shelly-cli/docs/commands/auth/test/>shelly auth test</a></li></ul></details></li><li><details><summary>shelly backup</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/backup/create/>shelly backup create</a></li><li><a href=/shelly-cli/docs/commands/backup/export/>shelly backup export</a></li><li><a href=/shelly-cli/docs/commands/backup/list/>shelly backup list</a></li><li><a href=/shelly-cli/docs/commands/backup/restore/>shelly backup restore</a></li></ul></details></li><li><details><summary>shelly batch</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/batch/command/>shelly batch command</a></li><li><a href=/shelly-cli/docs/commands/batch/off/>shelly batch off</a></li><li><a href=/shelly-cli/docs/commands/batch/on/>shelly batch on</a></li><li><a href=/shelly-cli/docs/commands/batch/toggle/>shelly batch toggle</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/benchmark/>shelly benchmark</a></li><li><details><summary>shelly bthome</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/bthome/add/>shelly bthome add</a></li><li><a href=/shelly-cli/docs/commands/bthome/list/>shelly bthome list</a></li><li><a href=/shelly-cli/docs/commands/bthome/remove/>shelly bthome remove</a></li><li><a href=/shelly-cli/docs/commands/bthome/status/>shelly bthome status</a></li></ul></details></li><li><details><summary>shelly cache</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cache/clear/>shelly cache clear</a></li><li><a href=/shelly-cli/docs/commands/cache/show/>shelly cache show</a></li></ul></details></li><li><details><summary>shelly cert</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cert/install/>shelly cert install</a></li><li><a href=/shelly-cli/docs/commands/cert/show/>shelly cert show</a></li></ul></details></li><li><details><summary>shelly cloud</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cloud/auth-status/>shelly cloud auth-status</a></li><li><a href=/shelly-cli/docs/commands/cloud/control/>shelly cloud control</a></li><li><a href=/shelly-cli/docs/commands/cloud/device/>shelly cloud device</a></li><li><a href=/shelly-cli/docs/commands/cloud/devices/>shelly cloud devices</a></li><li><a href=/shelly-cli/docs/commands/cloud/disable/>shelly cloud disable</a></li><li><a href=/shelly-cli/docs/commands/cloud/enable/>shelly cloud enable</a></li><li><a href=/shelly-cli/docs/commands/cloud/events/>shelly cloud events</a></li><li><a href=/shelly-cli/docs/commands/cloud/login/>shelly cloud login</a></li><li><a href=/shelly-cli/docs/commands/cloud/logout/>shelly cloud logout</a></li><li><a href=/shelly-cli/docs/commands/cloud/status/>shelly cloud status</a></li><li><a href=/shelly-cli/docs/commands/cloud/token/>shelly cloud token</a></li></ul></details></li><li><details><summary>shelly completion</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/completion/bash/>shelly completion bash</a></li><li><a href=/shelly-cli/docs/commands/completion/fish/>shelly completion fish</a></li><li><a href=/shelly-cli/docs/commands/completion/install/>shelly completion install</a></li><li><a href=/shelly-cli/docs/commands/completion/powershell/>shelly completion powershell</a></li><li><a href=/shelly-cli/docs/commands/completion/zsh/>shelly completion zsh</a></li></ul></details></li><li><details><summary>shelly config</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/config/delete/>shelly config delete</a></li><li><a href=/shelly-cli/docs/commands/config/edit/>shelly config edit</a></li><li><a href=/shelly-cli/docs/commands/config/get/>shelly config get</a></li><li><a href=/shelly-cli/docs/commands/config/path/>shelly config path</a></li><li><a href=/shelly-cli/docs/commands/config/reset/>shelly config reset</a></li><li><a href=/shelly-cli/docs/commands/config/set/>shelly config set</a></li><li><a href=/shelly-cli/docs/commands/config/show/>shelly config show</a></li></ul></details></li><li><details><summary>shelly cover</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cover/calibrate/>shelly cover calibrate</a></li><li><a href=/shelly-cli/docs/commands/cover/close/>shelly cover close</a></li><li><a href=/shelly-cli/docs/commands/cover/list/>shelly cover list</a></li><li><a href=/shelly-cli/docs/commands/cover/open/>shelly cover open</a></li><li><a href=/shelly-cli/docs/commands/cover/position/>shelly cover position</a></li><li><a href=/shelly-cli/docs/commands/cover/status/>shelly cover status</a></li><li><a href=/shelly-cli/docs/commands/cover/stop/>shelly cover stop</a></li></ul></details></li><li><details><summary>shelly dash</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/dash/devices/>shelly dash devices</a></li><li><a href=/shelly-cli/docs/commands/dash/events/>shelly dash events</a></li></ul></details></li><li><details><summary>shelly debug</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/debug/coiot/>shelly debug coiot</a></li><li><a href=/shelly-cli/docs/commands/debug/log/>shelly debug log</a></li><li><a href=/shelly-cli/docs/commands/debug/websocket/>shelly debug websocket</a></li></ul></details></li><li><details><summary>shelly device</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/device/alias/>shelly device alias</a></li><li><a href=/shelly-cli/docs/commands/device/config/>shelly device config</a></li><li><a href=/shelly-cli/docs/commands/device/config-diff/>shelly device config diff</a></li><li><a href=/shelly-cli/docs/commands/device/config-export/>shelly device config export</a></li><li><a href=/shelly-cli/docs/commands/device/config-get/>shelly device config get</a></li><li><a href=/shelly-cli/docs/commands/device/config-import/>shelly device config import</a></li><li><a href=/shelly-cli/docs/commands/device/config-reset/>shelly device config reset</a></li><li><a href=/shelly-cli/docs/commands/device/config-set/>shelly device config set</a></li><li><a href=/shelly-cli/docs/commands/device/factory-reset/>shelly device factory-reset</a></li><li><a href=/shelly-cli/docs/commands/device/info/>shelly device info</a></li><li><a href=/shelly-cli/docs/commands/device/list/>shelly device list</a></li><li><a href=/shelly-cli/docs/commands/device/ping/>shelly device ping</a></li><li><a href=/shelly-cli/docs/commands/device/reboot/>shelly device reboot</a></li><li><a href=/shelly-cli/docs/commands/device/status/>shelly device status</a></li><li><a href=/shelly-cli/docs/commands/device/ui/>shelly device ui</a></li></ul></details></li><li><details><summary>shelly discover</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/discover/ble/>shelly discover ble</a></li><li><a href=/shelly-cli/docs/commands/discover/coiot/>shelly discover coiot</a></li><li><a href=/shelly-cli/docs/commands/discover/http/>shelly discover http</a></li><li><a href=/shelly-cli/docs/commands/discover/mdns/>shelly discover mdns</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/doctor/>shelly doctor</a></li><li><details><summary>shelly energy</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/energy/compare/>shelly energy compare</a></li><li><a href=/shelly-cli/docs/commands/energy/dashboard/>shelly energy dashboard</a></li><li><a href=/shelly-cli/docs/commands/energy/export/>shelly energy export</a></li><li><a href=/shelly-cli/docs/commands/energy/history/>shelly energy history</a></li><li><a href=/shelly-cli/docs/commands/energy/list/>shelly energy list</a></li><li><a href=/shelly-cli/docs/commands/energy/reset/>shelly energy reset</a></li><li><a href=/shelly-cli/docs/commands/energy/status/>shelly energy status</a></li></ul></details></li><li><details><summary>shelly ethernet</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/ethernet/set/>shelly ethernet set</a></li><li><a href=/shelly-cli/docs/commands/ethernet/status/>shelly ethernet status</a></li></ul></details></li><li><details><summary>shelly export</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/export/ansible/>shelly export ansible</a></li><li><a href=/shelly-cli/docs/commands/export/csv/>shelly export csv</a></li><li><a href=/shelly-cli/docs/commands/export/terraform/>shelly export terraform</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/feedback/>shelly feedback</a></li><li><details><summary>shelly firmware</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/firmware/check/>shelly firmware check</a></li><li><a href=/shelly-cli/docs/commands/firmware/download/>shelly firmware download</a></li><li><a href=/shelly-cli/docs/commands/firmware/rollback/>shelly firmware rollback</a></li><li><a href=/shelly-cli/docs/commands/firmware/status/>shelly firmware status</a></li><li><a href=/shelly-cli/docs/commands/firmware/update/>shelly firmware update</a></li><li><a href=/shelly-cli/docs/commands/firmware/updates/>shelly firmware updates</a></li></ul></details></li><li><details><summary>shelly fleet</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/fleet/connect/>shelly fleet connect</a></li><li><a href=/shelly-cli/docs/commands/fleet/disconnect/>shelly fleet disconnect</a></li><li><a href=/shelly-cli/docs/commands/fleet/health/>shelly fleet health</a></li><li><a href=/shelly-cli/docs/commands/fleet/off/>shelly fleet off</a></li><li><a href=/shelly-cli/docs/commands/fleet/on/>shelly fleet on</a></li><li><a href=/shelly-cli/docs/commands/fleet/stats/>shelly fleet stats</a></li><li><a href=/shelly-cli/docs/commands/fleet/status/>shelly fleet status</a></li><li><a href=/shelly-cli/docs/commands/fleet/toggle/>shelly fleet toggle</a></li></ul></details></li><li><details><summary>shelly group</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/group/add/>shelly group add</a></li><li><a href=/shelly-cli/docs/commands/group/create/>shelly group create</a></li><li><a href=/shelly-cli/docs/commands/group/delete/>shelly group delete</a></li><li><a href=/shelly-cli/docs/commands/group/list/>shelly group list</a></li><li><a href=/shelly-cli/docs/commands/group/members/>shelly group members</a></li><li><a href=/shelly-cli/docs/commands/group/remove/>shelly group remove</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/init/>shelly init</a></li><li><details><summary>shelly input</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/input/disable/>shelly input disable</a></li><li><a href=/shelly-cli/docs/commands/input/enable/>shelly input enable</a></li><li><a href=/shelly-cli/docs/commands/input/list/>shelly input list</a></li><li><a href=/shelly-cli/docs/commands/input/status/>shelly input status</a></li><li><a href=/shelly-cli/docs/commands/input/trigger/>shelly input trigger</a></li></ul></details></li><li><details><summary>shelly kvs</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/kvs/delete/>shelly kvs delete</a></li><li><a href=/shelly-cli/docs/commands/kvs/export/>shelly kvs export</a></li><li><a href=/shelly-cli/docs/commands/kvs/get/>shelly kvs get</a></li><li><a href=/shelly-cli/docs/commands/kvs/import/>shelly kvs import</a></li><li><a href=/shelly-cli/docs/commands/kvs/list/>shelly kvs list</a></li><li><a href=/shelly-cli/docs/commands/kvs/set/>shelly kvs set</a></li></ul></details></li><li><details><summary>shelly light</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/light/list/>shelly light list</a></li><li><a href=/shelly-cli/docs/commands/light/off/>shelly light off</a></li><li><a href=/shelly-cli/docs/commands/light/on/>shelly light on</a></li><li><a href=/shelly-cli/docs/commands/light/set/>shelly light set</a></li><li><a href=/shelly-cli/docs/commands/light/status/>shelly light status</a></li><li><a href=/shelly-cli/docs/commands/light/toggle/>shelly light toggle</a></li></ul></details></li><li><details><summary>shelly log</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/log/clear/>shelly log clear</a></li><li><a href=/shelly-cli/docs/commands/log/export/>shelly log export</a></li><li><a href=/shelly-cli/docs/commands/log/path/>shelly log path</a></li><li><a href=/shelly-cli/docs/commands/log/show/>shelly log show</a></li><li><a href=/shelly-cli/docs/commands/log/tail/>shelly log tail</a></li></ul></details></li><li><details><summary>shelly lora</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/lora/config/>shelly lora config</a></li><li><a href=/shelly-cli/docs/commands/lora/send/>shelly lora send</a></li><li><a href=/shelly-cli/docs/commands/lora/status/>shelly lora status</a></li></ul></details></li><li><details><summary>shelly matter</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/matter/code/>shelly matter code</a></li><li><a href=/shelly-cli/docs/commands/matter/disable/>shelly matter disable</a></li><li><a href=/shelly-cli/docs/commands/matter/enable/>shelly matter enable</a></li><li><a href=/shelly-cli/docs/commands/matter/reset/>shelly matter reset</a></li><li><a href=/shelly-cli/docs/commands/matter/status/>shelly matter status</a></li></ul></details></li><li><details><summary>shelly metrics</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/metrics/influxdb/>shelly metrics influxdb</a></li><li><a href=/shelly-cli/docs/commands/metrics/json/>shelly metrics json</a></li><li><a href=/shelly-cli/docs/commands/metrics/prometheus/>shelly metrics prometheus</a></li></ul></details></li><li><details><summary>shelly migrate</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/migrate/diff/>shelly migrate diff</a></li><li><a href=/shelly-cli/docs/commands/migrate/validate/>shelly migrate validate</a></li></ul></details></li><li><details><summary>shelly mock</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/mock/create/>shelly mock create</a></li><li><a href=/shelly-cli/docs/commands/mock/delete/>shelly mock delete</a></li><li><a href=/shelly-cli/docs/commands/mock/list/>shelly mock list</a></li><li><a href=/shelly-cli/docs/commands/mock/scenario/>shelly mock scenario</a></li></ul></details></li><li><details><summary>shelly modbus</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/modbus/disable/>shelly modbus disable</a></li><li><a href=/shelly-cli/docs/commands/modbus/enable/>shelly modbus enable</a></li><li><a href=/shelly-cli/docs/commands/modbus/status/>shelly modbus status</a></li></ul></details></li><li><details><summary>shelly monitor</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/monitor/all/>shelly monitor all</a></li><li><a href=/shelly-cli/docs/commands/monitor/events/>shelly monitor events</a></li><li><a href=/shelly-cli/docs/commands/monitor/power/>shelly monitor power</a></li><li><a href=/shelly-cli/docs/commands/monitor/status/>shelly monitor status</a></li></ul></details></li><li><details><summary>shelly mqtt</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/mqtt/disable/>shelly mqtt disable</a></li><li><a href=/shelly-cli/docs/commands/mqtt/set/>shelly mqtt set</a></li><li><a href=/shelly-cli/docs/commands/mqtt/status/>shelly mqtt status</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/off/>shelly off</a></li><li><a href=/shelly-cli/docs/commands/on/>shelly on</a></li><li><a href=/shelly-cli/docs/commands/party/>shelly party</a></li><li><details><summary>shelly plugin</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/plugin/create/>shelly plugin create</a></li><li><a href=/shelly-cli/docs/commands/plugin/exec/>shelly plugin exec</a></li><li><a href=/shelly-cli/docs/commands/plugin/install/>shelly plugin install</a></li><li><a href=/shelly-cli/docs/commands/plugin/list/>shelly plugin list</a></li><li><a href=/shelly-cli/docs/commands/plugin/remove/>shelly plugin remove</a></li><li><a href=/shelly-cli/docs/commands/plugin/upgrade/>shelly plugin upgrade</a></li></ul></details></li><li><details><summary>shelly power</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/power/list/>shelly power list</a></li><li><a href=/shelly-cli/docs/commands/power/status/>shelly power status</a></li></ul></details></li><li><details><summary>shelly profile</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/profile/info/>shelly profile info</a></li><li><a href=/shelly-cli/docs/commands/profile/list/>shelly profile list</a></li><li><a href=/shelly-cli/docs/commands/profile/search/>shelly profile search</a></li></ul></details></li><li><details><summary>shelly provision</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/provision/ble/>shelly provision ble</a></li><li><a href=/shelly-cli/docs/commands/provision/bulk/>shelly provision bulk</a></li><li><a href=/shelly-cli/docs/commands/provision/wifi/>shelly provision wifi</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/qr/>shelly qr</a></li><li><a href=/shelly-cli/docs/commands/repl/>shelly repl</a></li><li><a href=/shelly-cli/docs/commands/report/>shelly report</a></li><li><details><summary>shelly rgb</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/rgb/list/>shelly rgb list</a></li><li><a href=/shelly-cli/docs/commands/rgb/off/>shelly rgb off</a></li><li><a href=/shelly-cli/docs/commands/rgb/on/>shelly rgb on</a></li><li><a href=/shelly-cli/docs/commands/rgb/set/>shelly rgb set</a></li><li><a href=/shelly-cli/docs/commands/rgb/status/>shelly rgb status</a></li><li><a href=/shelly-cli/docs/commands/rgb/toggle/>shelly rgb toggle</a></li></ul></details></li><li><details><summary>shelly rgbw</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/rgbw/list/>shelly rgbw list</a></li><li><a href=/shelly-cli/docs/commands/rgbw/off/>shelly rgbw off</a></li><li><a href=/shelly-cli/docs/commands/rgbw/on/>shelly rgbw on</a></li><li><a href=/shelly-cli/docs/commands/rgbw/set/>shelly rgbw set</a></li><li><a href=/shelly-cli/docs/commands/rgbw/status/>shelly rgbw status</a></li><li><a href=/shelly-cli/docs/commands/rgbw/toggle/>shelly rgbw toggle</a></li></ul></details></li><li><details><summary>shelly scene</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/scene/activate/>shelly scene activate</a></li><li><a href=/shelly-cli/docs/commands/scene/create/>shelly scene create</a></li><li><a href=/shelly-cli/docs/commands/scene/delete/>shelly scene delete</a></li><li><a href=/shelly-cli/docs/commands/scene/export/>shelly scene export</a></li><li><a href=/shelly-cli/docs/commands/scene/import/>shelly scene import</a></li><li><a href=/shelly-cli/docs/commands/scene/list/>shelly scene list</a></li><li><a href=/shelly-cli/docs/commands/scene/show/>shelly scene show</a></li></ul></details></li><li><details><summary>shelly schedule</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/schedule/create/>shelly schedule create</a></li><li><a href=/shelly-cli/docs/commands/schedule/delete/>shelly schedule delete</a></li><li><a href=/shelly-cli/docs/commands/schedule/delete-all/>shelly schedule delete-all</a></li><li><a href=/shelly-cli/docs/commands/schedule/disable/>shelly schedule disable</a></li><li><a href=/shelly-cli/docs/commands/schedule/enable/>shelly schedule enable</a></li><li><a href=/shelly-cli/docs/commands/schedule/list/>shelly schedule list</a></li><li><a href=/shelly-cli/docs/commands/schedule/update/>shelly schedule update</a></li></ul></details></li><li><details><summary>shelly script</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/script/create/>shelly script create</a></li><li><a href=/shelly-cli/docs/commands/script/delete/>shelly script delete</a></li><li><a href=/shelly-cli/docs/commands/script/download/>shelly script download</a></li><li><a href=/shelly-cli/docs/commands/script/eval/>shelly script eval</a></li><li><a href=/shelly-cli/docs/commands/script/get/>shelly script get</a></li><li><a href=/shelly-cli/docs/commands/script/list/>shelly script list</a></li><li><a href=/shelly-cli/docs/commands/script/start/>shelly script start</a></li><li><a href=/shelly-cli/docs/commands/script/stop/>shelly script stop</a></li><li><a href=/shelly-cli/docs/commands/script/template/>shelly script template</a></li><li><a href=/shelly-cli/docs/commands/script/template-install/>shelly script template install</a></li><li><a href=/shelly-cli/docs/commands/script/template-list/>shelly script template list</a></li><li><a href=/shelly-cli/docs/commands/script/template-show/>shelly script template show</a></li><li><a href=/shelly-cli/docs/commands/script/update/>shelly script update</a></li><li><a href=/shelly-cli/docs/commands/script/upload/>shelly script upload</a></li></ul></details></li><li><details><summary>shelly sensor</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/sensor/devicepower/>shelly sensor devicepower</a></li><li><a href=/shelly-cli/docs/commands/sensor/devicepower-list/>shelly sensor devicepower list</a></li><li><a href=/shelly-cli/docs/commands/sensor/devicepower-status/>shelly sensor devicepower status</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood/>shelly sensor flood</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-list/>shelly sensor flood list</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-status/>shelly sensor flood status</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-test/>shelly sensor flood test</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity/>shelly sensor humidity</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity-list/>shelly sensor humidity list</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity-status/>shelly sensor humidity status</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance/>shelly sensor illuminance</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance-list/>shelly sensor illuminance list</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance-status/>shelly sensor illuminance status</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke/>shelly sensor smoke</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-list/>shelly sensor smoke list</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-mute/>shelly sensor smoke mute</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-status/>shelly sensor smoke status</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-test/>shelly sensor smoke test</a></li><li><a href=/shelly-cli/docs/commands/sensor/status/>shelly sensor status</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature/>shelly sensor temperature</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature-list/>shelly sensor temperature list</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature-status/>shelly sensor temperature status</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter/>shelly sensor voltmeter</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter-list/>shelly sensor voltmeter list</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter-status/>shelly sensor voltmeter status</a></li></ul></details></li><li><details><summary>shelly sensoraddon</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/sensoraddon/add/>shelly sensoraddon add</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/list/>shelly sensoraddon list</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/remove/>shelly sensoraddon remove</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/scan/>shelly sensoraddon scan</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/shell/>shelly shell</a></li><li><a href=/shelly-cli/docs/commands/sleep/>shelly sleep</a></li><li><a href=/shelly-cli/docs/commands/status/>shelly status</a></li><li><details><summary>shelly switch</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/switch/list/>shelly switch list</a></li><li><a href=/shelly-cli/docs/commands/switch/off/>shelly switch off</a></li><li><a href=/shelly-cli/docs/commands/switch/on/>shelly switch on</a></li><li><a href=/shelly-cli/docs/commands/switch/status/>shelly switch status</a></li><li><a href=/shelly-cli/docs/commands/switch/toggle/>shelly switch toggle</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/sync/>shelly sync</a></li><li><details><summary>shelly template</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/template/apply/>shelly template apply</a></li><li><a href=/shelly-cli/docs/commands/template/create/>shelly template create</a></li><li><a href=/shelly-cli/docs/commands/template/delete/>shelly template delete</a></li><li><a href=/shelly-cli/docs/commands/template/diff/>shelly template diff</a></li><li><a href=/shelly-cli/docs/commands/template/export/>shelly template export</a></li><li><a href=/shelly-cli/docs/commands/template/import/>shelly template import</a></li><li><a href=/shelly-cli/docs/commands/template/list/>shelly template list</a></li></ul></details></li><li><details><summary>shelly theme</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/theme/current/>shelly theme current</a></li><li><a href=/shelly-cli/docs/commands/theme/export/>shelly theme export</a></li><li><a href=/shelly-cli/docs/commands/theme/import/>shelly theme import</a></li><li><a href=/shelly-cli/docs/commands/theme/list/>shelly theme list</a></li><li><a href=/shelly-cli/docs/commands/theme/next/>shelly theme next</a></li><li><a href=/shelly-cli/docs/commands/theme/prev/>shelly theme prev</a></li><li><a href=/shelly-cli/docs/commands/theme/preview/>shelly theme preview</a></li><li><a href=/shelly-cli/docs/commands/theme/semantic/>shelly theme semantic</a></li><li><a href=/shelly-cli/docs/commands/theme/set/>shelly theme set</a></li></ul></details></li><li><details><summary>shelly thermostat</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/thermostat/boost/>shelly thermostat boost</a></li><li><a href=/shelly-cli/docs/commands/thermostat/calibrate/>shelly thermostat calibrate</a></li><li><a href=/shelly-cli/docs/commands/thermostat/disable/>shelly thermostat disable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/enable/>shelly thermostat enable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/list/>shelly thermostat list</a></li><li><a href=/shelly-cli/docs/commands/thermostat/override/>shelly thermostat override</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule/>shelly thermostat schedule</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-create/>shelly thermostat schedule create</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-delete/>shelly thermostat schedule delete</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-disable/>shelly thermostat schedule disable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-enable/>shelly thermostat schedule enable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-list/>shelly thermostat schedule list</a></li><li><a href=/shelly-cli/docs/commands/thermostat/set/>shelly thermostat set</a></li><li><a href=/shelly-cli/docs/commands/thermostat/status/>shelly thermostat status</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/toggle/>shelly toggle</a></li><li><a href=/shelly-cli/docs/commands/update/>shelly update</a></li><li><a href=/shelly-cli/docs/commands/version/>shelly version</a></li><li><details><summary>shelly virtual</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/virtual/create/>shelly virtual create</a></li><li><a href=/shelly-cli/docs/commands/virtual/delete/>shelly virtual delete</a></li><li><a href=/shelly-cli/docs/commands/virtual/get/>shelly virtual get</a></li><li><a href=/shelly-cli/docs/commands/virtual/list/>shelly virtual list</a></li><li><a href=/shelly-cli/docs/commands/virtual/set/>shelly virtual set</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/wait/>shelly wait</a></li><li><a href=/shelly-cli/docs/commands/wake/>shelly wake</a></li><li><details><summary>shelly webhook</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/webhook/create/>shelly webhook create</a></li><li><a href=/shelly-cli/docs/commands/webhook/delete/>shelly webhook delete</a></li><li><a href=/shelly-cli/docs/commands/webhook/list/>shelly webhook list</a></li><li><a href=/shelly-cli/docs/commands/webhook/server/>shelly webhook server</a></li><li><a href=/shelly-cli/docs/commands/webhook/update/>shelly webhook update</a></li></ul></details></li><li><details><summary>shelly wifi</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/wifi/ap/>shelly wifi ap</a></li><li><a href=/shelly-cli/docs/commands/wifi/scan/>shelly wifi scan</a></li><li><a href=/shelly-cli/docs/commands/wifi/set/>shelly wifi set</a></li><li><a href=/shelly-cli/docs/commands/wifi/status/>shelly wifi status</a></li></ul></details></li><li><details><summary>shelly zigbee</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/zigbee/list/>shelly zigbee list</a></li><li><a href=/shelly-cli/docs/commands/zigbee/pair/>shelly zigbee pair</a></li><li><a href=/shelly-cli/docs/commands/zigbee/remove/>shelly zigbee remove</a></li><li><a href=/shelly-cli/docs/commands/zigbee/status/>shelly zigbee status</a></li></ul></details></li><li><details><summary>shelly zwave</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/zwave/config/>shelly zwave config</a></li><li><a href=/shelly-cli/docs/commands/zwave/exclusion/>shelly zwave exclusion</a></li><li><a href=/shelly-cli/docs/commands/zwave/inclusion/>shelly zwave inclusion</a></li><li><a href=/shelly-cli/docs/commands/zwave/info/>shelly zwave info</a></li><li><a href=/shelly-cli/docs/commands/zwave/reset/>shelly zwave reset</a></li></ul></details></li></ul></details></li><li><a href=/shelly-cli/docs/configuration/>Configuration Reference</a></li><li><details open><summary>Guides</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/guides/tui-dashboard/>TUI Dashboard</a></li><li><a href=/shelly-cli/docs/guides/tasmota/>Tasmota Devices</a></li></ul></details></li><li><a href=/shelly-cli/docs/plugins/>Plugin System</a></li><li><a href=/shelly-cli/docs/themes/>Theme System</a></li><li><details open><summary>Reference</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/reference/architecture/>Project Architecture</a></li><li><a href=/shelly-cli/docs/reference/dependencies/>Dependencies</a></li></ul></details></li><li><details open open><summary>Contributing</summary><ul class="list-unstyled list-nested"><li class=active><a aria-current=page href=/shelly-cli/docs/contributing/development/>Development Guide</a></li><li><a href=/shelly-cli/docs/contributing/testing/>Testing Strategy</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Shelly CLI</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://tj-smith47.github.io/shelly-cli/docs/ aria-current=true>Docs</a></li><li class=nav-item><a class=nav-link href=https://tj-smith47.github.io/shelly-cli/docs/commands/>Commands</a></li><li class=nav-item><a class=nav-link href=https://tj-smith47.github.io/shelly-cli/examples/>Examples</a></li><li class=nav-item><a class=nav-link href=https://github.com/tj-smith47/shelly-cli>GitHub</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button><div class="dropdown mt-1 order-lg-3"><button class="btn btn-dropdown dropdown-toggle" id=doks-versions data-bs-toggle=dropdown aria-expanded=false data-bs-display=static aria-label="Toggle version menu">
latest
<span class=dropdown-caret><svg class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6 6-6"/></svg></span></button><ul class="dropdown-menu dropdown-menu-lg-end me-lg-2 shadow rounded border-0" aria-labelledby=doks-versions><li><a class="dropdown-item current" aria-current=true href=/docs/>latest</a></li></ul></div><button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search indexâ€¦</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/getting-started/installation/>Installation</a></li><li><a href=/shelly-cli/docs/getting-started/quickstart/>Quick Start</a></li><li><a href=/shelly-cli/docs/getting-started/first-device/>Adding Your First Device</a></li></ul></details></li><li><details><summary>Command Reference</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/shelly/>shelly shelly</a></li><li><details><summary>shelly action</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/action/clear/>shelly action clear</a></li><li><a href=/shelly-cli/docs/commands/action/list/>shelly action list</a></li><li><a href=/shelly-cli/docs/commands/action/set/>shelly action set</a></li><li><a href=/shelly-cli/docs/commands/action/test/>shelly action test</a></li></ul></details></li><li><details><summary>shelly alert</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/alert/create/>shelly alert create</a></li><li><a href=/shelly-cli/docs/commands/alert/list/>shelly alert list</a></li><li><a href=/shelly-cli/docs/commands/alert/snooze/>shelly alert snooze</a></li><li><a href=/shelly-cli/docs/commands/alert/test/>shelly alert test</a></li><li><a href=/shelly-cli/docs/commands/alert/watch/>shelly alert watch</a></li></ul></details></li><li><details><summary>shelly alias</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/alias/delete/>shelly alias delete</a></li><li><a href=/shelly-cli/docs/commands/alias/export/>shelly alias export</a></li><li><a href=/shelly-cli/docs/commands/alias/import/>shelly alias import</a></li><li><a href=/shelly-cli/docs/commands/alias/list/>shelly alias list</a></li><li><a href=/shelly-cli/docs/commands/alias/set/>shelly alias set</a></li></ul></details></li><li><details><summary>shelly api</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/api/methods/>shelly api methods</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/audit/>shelly audit</a></li><li><details><summary>shelly auth</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/auth/disable/>shelly auth disable</a></li><li><a href=/shelly-cli/docs/commands/auth/export/>shelly auth export</a></li><li><a href=/shelly-cli/docs/commands/auth/import/>shelly auth import</a></li><li><a href=/shelly-cli/docs/commands/auth/rotate/>shelly auth rotate</a></li><li><a href=/shelly-cli/docs/commands/auth/set/>shelly auth set</a></li><li><a href=/shelly-cli/docs/commands/auth/status/>shelly auth status</a></li><li><a href=/shelly-cli/docs/commands/auth/test/>shelly auth test</a></li></ul></details></li><li><details><summary>shelly backup</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/backup/create/>shelly backup create</a></li><li><a href=/shelly-cli/docs/commands/backup/export/>shelly backup export</a></li><li><a href=/shelly-cli/docs/commands/backup/list/>shelly backup list</a></li><li><a href=/shelly-cli/docs/commands/backup/restore/>shelly backup restore</a></li></ul></details></li><li><details><summary>shelly batch</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/batch/command/>shelly batch command</a></li><li><a href=/shelly-cli/docs/commands/batch/off/>shelly batch off</a></li><li><a href=/shelly-cli/docs/commands/batch/on/>shelly batch on</a></li><li><a href=/shelly-cli/docs/commands/batch/toggle/>shelly batch toggle</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/benchmark/>shelly benchmark</a></li><li><details><summary>shelly bthome</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/bthome/add/>shelly bthome add</a></li><li><a href=/shelly-cli/docs/commands/bthome/list/>shelly bthome list</a></li><li><a href=/shelly-cli/docs/commands/bthome/remove/>shelly bthome remove</a></li><li><a href=/shelly-cli/docs/commands/bthome/status/>shelly bthome status</a></li></ul></details></li><li><details><summary>shelly cache</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cache/clear/>shelly cache clear</a></li><li><a href=/shelly-cli/docs/commands/cache/show/>shelly cache show</a></li></ul></details></li><li><details><summary>shelly cert</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cert/install/>shelly cert install</a></li><li><a href=/shelly-cli/docs/commands/cert/show/>shelly cert show</a></li></ul></details></li><li><details><summary>shelly cloud</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cloud/auth-status/>shelly cloud auth-status</a></li><li><a href=/shelly-cli/docs/commands/cloud/control/>shelly cloud control</a></li><li><a href=/shelly-cli/docs/commands/cloud/device/>shelly cloud device</a></li><li><a href=/shelly-cli/docs/commands/cloud/devices/>shelly cloud devices</a></li><li><a href=/shelly-cli/docs/commands/cloud/disable/>shelly cloud disable</a></li><li><a href=/shelly-cli/docs/commands/cloud/enable/>shelly cloud enable</a></li><li><a href=/shelly-cli/docs/commands/cloud/events/>shelly cloud events</a></li><li><a href=/shelly-cli/docs/commands/cloud/login/>shelly cloud login</a></li><li><a href=/shelly-cli/docs/commands/cloud/logout/>shelly cloud logout</a></li><li><a href=/shelly-cli/docs/commands/cloud/status/>shelly cloud status</a></li><li><a href=/shelly-cli/docs/commands/cloud/token/>shelly cloud token</a></li></ul></details></li><li><details><summary>shelly completion</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/completion/bash/>shelly completion bash</a></li><li><a href=/shelly-cli/docs/commands/completion/fish/>shelly completion fish</a></li><li><a href=/shelly-cli/docs/commands/completion/install/>shelly completion install</a></li><li><a href=/shelly-cli/docs/commands/completion/powershell/>shelly completion powershell</a></li><li><a href=/shelly-cli/docs/commands/completion/zsh/>shelly completion zsh</a></li></ul></details></li><li><details><summary>shelly config</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/config/delete/>shelly config delete</a></li><li><a href=/shelly-cli/docs/commands/config/edit/>shelly config edit</a></li><li><a href=/shelly-cli/docs/commands/config/get/>shelly config get</a></li><li><a href=/shelly-cli/docs/commands/config/path/>shelly config path</a></li><li><a href=/shelly-cli/docs/commands/config/reset/>shelly config reset</a></li><li><a href=/shelly-cli/docs/commands/config/set/>shelly config set</a></li><li><a href=/shelly-cli/docs/commands/config/show/>shelly config show</a></li></ul></details></li><li><details><summary>shelly cover</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/cover/calibrate/>shelly cover calibrate</a></li><li><a href=/shelly-cli/docs/commands/cover/close/>shelly cover close</a></li><li><a href=/shelly-cli/docs/commands/cover/list/>shelly cover list</a></li><li><a href=/shelly-cli/docs/commands/cover/open/>shelly cover open</a></li><li><a href=/shelly-cli/docs/commands/cover/position/>shelly cover position</a></li><li><a href=/shelly-cli/docs/commands/cover/status/>shelly cover status</a></li><li><a href=/shelly-cli/docs/commands/cover/stop/>shelly cover stop</a></li></ul></details></li><li><details><summary>shelly dash</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/dash/devices/>shelly dash devices</a></li><li><a href=/shelly-cli/docs/commands/dash/events/>shelly dash events</a></li></ul></details></li><li><details><summary>shelly debug</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/debug/coiot/>shelly debug coiot</a></li><li><a href=/shelly-cli/docs/commands/debug/log/>shelly debug log</a></li><li><a href=/shelly-cli/docs/commands/debug/websocket/>shelly debug websocket</a></li></ul></details></li><li><details><summary>shelly device</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/device/alias/>shelly device alias</a></li><li><a href=/shelly-cli/docs/commands/device/config/>shelly device config</a></li><li><a href=/shelly-cli/docs/commands/device/config-diff/>shelly device config diff</a></li><li><a href=/shelly-cli/docs/commands/device/config-export/>shelly device config export</a></li><li><a href=/shelly-cli/docs/commands/device/config-get/>shelly device config get</a></li><li><a href=/shelly-cli/docs/commands/device/config-import/>shelly device config import</a></li><li><a href=/shelly-cli/docs/commands/device/config-reset/>shelly device config reset</a></li><li><a href=/shelly-cli/docs/commands/device/config-set/>shelly device config set</a></li><li><a href=/shelly-cli/docs/commands/device/factory-reset/>shelly device factory-reset</a></li><li><a href=/shelly-cli/docs/commands/device/info/>shelly device info</a></li><li><a href=/shelly-cli/docs/commands/device/list/>shelly device list</a></li><li><a href=/shelly-cli/docs/commands/device/ping/>shelly device ping</a></li><li><a href=/shelly-cli/docs/commands/device/reboot/>shelly device reboot</a></li><li><a href=/shelly-cli/docs/commands/device/status/>shelly device status</a></li><li><a href=/shelly-cli/docs/commands/device/ui/>shelly device ui</a></li></ul></details></li><li><details><summary>shelly discover</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/discover/ble/>shelly discover ble</a></li><li><a href=/shelly-cli/docs/commands/discover/coiot/>shelly discover coiot</a></li><li><a href=/shelly-cli/docs/commands/discover/http/>shelly discover http</a></li><li><a href=/shelly-cli/docs/commands/discover/mdns/>shelly discover mdns</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/doctor/>shelly doctor</a></li><li><details><summary>shelly energy</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/energy/compare/>shelly energy compare</a></li><li><a href=/shelly-cli/docs/commands/energy/dashboard/>shelly energy dashboard</a></li><li><a href=/shelly-cli/docs/commands/energy/export/>shelly energy export</a></li><li><a href=/shelly-cli/docs/commands/energy/history/>shelly energy history</a></li><li><a href=/shelly-cli/docs/commands/energy/list/>shelly energy list</a></li><li><a href=/shelly-cli/docs/commands/energy/reset/>shelly energy reset</a></li><li><a href=/shelly-cli/docs/commands/energy/status/>shelly energy status</a></li></ul></details></li><li><details><summary>shelly ethernet</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/ethernet/set/>shelly ethernet set</a></li><li><a href=/shelly-cli/docs/commands/ethernet/status/>shelly ethernet status</a></li></ul></details></li><li><details><summary>shelly export</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/export/ansible/>shelly export ansible</a></li><li><a href=/shelly-cli/docs/commands/export/csv/>shelly export csv</a></li><li><a href=/shelly-cli/docs/commands/export/terraform/>shelly export terraform</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/feedback/>shelly feedback</a></li><li><details><summary>shelly firmware</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/firmware/check/>shelly firmware check</a></li><li><a href=/shelly-cli/docs/commands/firmware/download/>shelly firmware download</a></li><li><a href=/shelly-cli/docs/commands/firmware/rollback/>shelly firmware rollback</a></li><li><a href=/shelly-cli/docs/commands/firmware/status/>shelly firmware status</a></li><li><a href=/shelly-cli/docs/commands/firmware/update/>shelly firmware update</a></li><li><a href=/shelly-cli/docs/commands/firmware/updates/>shelly firmware updates</a></li></ul></details></li><li><details><summary>shelly fleet</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/fleet/connect/>shelly fleet connect</a></li><li><a href=/shelly-cli/docs/commands/fleet/disconnect/>shelly fleet disconnect</a></li><li><a href=/shelly-cli/docs/commands/fleet/health/>shelly fleet health</a></li><li><a href=/shelly-cli/docs/commands/fleet/off/>shelly fleet off</a></li><li><a href=/shelly-cli/docs/commands/fleet/on/>shelly fleet on</a></li><li><a href=/shelly-cli/docs/commands/fleet/stats/>shelly fleet stats</a></li><li><a href=/shelly-cli/docs/commands/fleet/status/>shelly fleet status</a></li><li><a href=/shelly-cli/docs/commands/fleet/toggle/>shelly fleet toggle</a></li></ul></details></li><li><details><summary>shelly group</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/group/add/>shelly group add</a></li><li><a href=/shelly-cli/docs/commands/group/create/>shelly group create</a></li><li><a href=/shelly-cli/docs/commands/group/delete/>shelly group delete</a></li><li><a href=/shelly-cli/docs/commands/group/list/>shelly group list</a></li><li><a href=/shelly-cli/docs/commands/group/members/>shelly group members</a></li><li><a href=/shelly-cli/docs/commands/group/remove/>shelly group remove</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/init/>shelly init</a></li><li><details><summary>shelly input</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/input/disable/>shelly input disable</a></li><li><a href=/shelly-cli/docs/commands/input/enable/>shelly input enable</a></li><li><a href=/shelly-cli/docs/commands/input/list/>shelly input list</a></li><li><a href=/shelly-cli/docs/commands/input/status/>shelly input status</a></li><li><a href=/shelly-cli/docs/commands/input/trigger/>shelly input trigger</a></li></ul></details></li><li><details><summary>shelly kvs</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/kvs/delete/>shelly kvs delete</a></li><li><a href=/shelly-cli/docs/commands/kvs/export/>shelly kvs export</a></li><li><a href=/shelly-cli/docs/commands/kvs/get/>shelly kvs get</a></li><li><a href=/shelly-cli/docs/commands/kvs/import/>shelly kvs import</a></li><li><a href=/shelly-cli/docs/commands/kvs/list/>shelly kvs list</a></li><li><a href=/shelly-cli/docs/commands/kvs/set/>shelly kvs set</a></li></ul></details></li><li><details><summary>shelly light</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/light/list/>shelly light list</a></li><li><a href=/shelly-cli/docs/commands/light/off/>shelly light off</a></li><li><a href=/shelly-cli/docs/commands/light/on/>shelly light on</a></li><li><a href=/shelly-cli/docs/commands/light/set/>shelly light set</a></li><li><a href=/shelly-cli/docs/commands/light/status/>shelly light status</a></li><li><a href=/shelly-cli/docs/commands/light/toggle/>shelly light toggle</a></li></ul></details></li><li><details><summary>shelly log</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/log/clear/>shelly log clear</a></li><li><a href=/shelly-cli/docs/commands/log/export/>shelly log export</a></li><li><a href=/shelly-cli/docs/commands/log/path/>shelly log path</a></li><li><a href=/shelly-cli/docs/commands/log/show/>shelly log show</a></li><li><a href=/shelly-cli/docs/commands/log/tail/>shelly log tail</a></li></ul></details></li><li><details><summary>shelly lora</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/lora/config/>shelly lora config</a></li><li><a href=/shelly-cli/docs/commands/lora/send/>shelly lora send</a></li><li><a href=/shelly-cli/docs/commands/lora/status/>shelly lora status</a></li></ul></details></li><li><details><summary>shelly matter</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/matter/code/>shelly matter code</a></li><li><a href=/shelly-cli/docs/commands/matter/disable/>shelly matter disable</a></li><li><a href=/shelly-cli/docs/commands/matter/enable/>shelly matter enable</a></li><li><a href=/shelly-cli/docs/commands/matter/reset/>shelly matter reset</a></li><li><a href=/shelly-cli/docs/commands/matter/status/>shelly matter status</a></li></ul></details></li><li><details><summary>shelly metrics</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/metrics/influxdb/>shelly metrics influxdb</a></li><li><a href=/shelly-cli/docs/commands/metrics/json/>shelly metrics json</a></li><li><a href=/shelly-cli/docs/commands/metrics/prometheus/>shelly metrics prometheus</a></li></ul></details></li><li><details><summary>shelly migrate</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/migrate/diff/>shelly migrate diff</a></li><li><a href=/shelly-cli/docs/commands/migrate/validate/>shelly migrate validate</a></li></ul></details></li><li><details><summary>shelly mock</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/mock/create/>shelly mock create</a></li><li><a href=/shelly-cli/docs/commands/mock/delete/>shelly mock delete</a></li><li><a href=/shelly-cli/docs/commands/mock/list/>shelly mock list</a></li><li><a href=/shelly-cli/docs/commands/mock/scenario/>shelly mock scenario</a></li></ul></details></li><li><details><summary>shelly modbus</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/modbus/disable/>shelly modbus disable</a></li><li><a href=/shelly-cli/docs/commands/modbus/enable/>shelly modbus enable</a></li><li><a href=/shelly-cli/docs/commands/modbus/status/>shelly modbus status</a></li></ul></details></li><li><details><summary>shelly monitor</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/monitor/all/>shelly monitor all</a></li><li><a href=/shelly-cli/docs/commands/monitor/events/>shelly monitor events</a></li><li><a href=/shelly-cli/docs/commands/monitor/power/>shelly monitor power</a></li><li><a href=/shelly-cli/docs/commands/monitor/status/>shelly monitor status</a></li></ul></details></li><li><details><summary>shelly mqtt</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/mqtt/disable/>shelly mqtt disable</a></li><li><a href=/shelly-cli/docs/commands/mqtt/set/>shelly mqtt set</a></li><li><a href=/shelly-cli/docs/commands/mqtt/status/>shelly mqtt status</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/off/>shelly off</a></li><li><a href=/shelly-cli/docs/commands/on/>shelly on</a></li><li><a href=/shelly-cli/docs/commands/party/>shelly party</a></li><li><details><summary>shelly plugin</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/plugin/create/>shelly plugin create</a></li><li><a href=/shelly-cli/docs/commands/plugin/exec/>shelly plugin exec</a></li><li><a href=/shelly-cli/docs/commands/plugin/install/>shelly plugin install</a></li><li><a href=/shelly-cli/docs/commands/plugin/list/>shelly plugin list</a></li><li><a href=/shelly-cli/docs/commands/plugin/remove/>shelly plugin remove</a></li><li><a href=/shelly-cli/docs/commands/plugin/upgrade/>shelly plugin upgrade</a></li></ul></details></li><li><details><summary>shelly power</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/power/list/>shelly power list</a></li><li><a href=/shelly-cli/docs/commands/power/status/>shelly power status</a></li></ul></details></li><li><details><summary>shelly profile</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/profile/info/>shelly profile info</a></li><li><a href=/shelly-cli/docs/commands/profile/list/>shelly profile list</a></li><li><a href=/shelly-cli/docs/commands/profile/search/>shelly profile search</a></li></ul></details></li><li><details><summary>shelly provision</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/provision/ble/>shelly provision ble</a></li><li><a href=/shelly-cli/docs/commands/provision/bulk/>shelly provision bulk</a></li><li><a href=/shelly-cli/docs/commands/provision/wifi/>shelly provision wifi</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/qr/>shelly qr</a></li><li><a href=/shelly-cli/docs/commands/repl/>shelly repl</a></li><li><a href=/shelly-cli/docs/commands/report/>shelly report</a></li><li><details><summary>shelly rgb</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/rgb/list/>shelly rgb list</a></li><li><a href=/shelly-cli/docs/commands/rgb/off/>shelly rgb off</a></li><li><a href=/shelly-cli/docs/commands/rgb/on/>shelly rgb on</a></li><li><a href=/shelly-cli/docs/commands/rgb/set/>shelly rgb set</a></li><li><a href=/shelly-cli/docs/commands/rgb/status/>shelly rgb status</a></li><li><a href=/shelly-cli/docs/commands/rgb/toggle/>shelly rgb toggle</a></li></ul></details></li><li><details><summary>shelly rgbw</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/rgbw/list/>shelly rgbw list</a></li><li><a href=/shelly-cli/docs/commands/rgbw/off/>shelly rgbw off</a></li><li><a href=/shelly-cli/docs/commands/rgbw/on/>shelly rgbw on</a></li><li><a href=/shelly-cli/docs/commands/rgbw/set/>shelly rgbw set</a></li><li><a href=/shelly-cli/docs/commands/rgbw/status/>shelly rgbw status</a></li><li><a href=/shelly-cli/docs/commands/rgbw/toggle/>shelly rgbw toggle</a></li></ul></details></li><li><details><summary>shelly scene</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/scene/activate/>shelly scene activate</a></li><li><a href=/shelly-cli/docs/commands/scene/create/>shelly scene create</a></li><li><a href=/shelly-cli/docs/commands/scene/delete/>shelly scene delete</a></li><li><a href=/shelly-cli/docs/commands/scene/export/>shelly scene export</a></li><li><a href=/shelly-cli/docs/commands/scene/import/>shelly scene import</a></li><li><a href=/shelly-cli/docs/commands/scene/list/>shelly scene list</a></li><li><a href=/shelly-cli/docs/commands/scene/show/>shelly scene show</a></li></ul></details></li><li><details><summary>shelly schedule</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/schedule/create/>shelly schedule create</a></li><li><a href=/shelly-cli/docs/commands/schedule/delete/>shelly schedule delete</a></li><li><a href=/shelly-cli/docs/commands/schedule/delete-all/>shelly schedule delete-all</a></li><li><a href=/shelly-cli/docs/commands/schedule/disable/>shelly schedule disable</a></li><li><a href=/shelly-cli/docs/commands/schedule/enable/>shelly schedule enable</a></li><li><a href=/shelly-cli/docs/commands/schedule/list/>shelly schedule list</a></li><li><a href=/shelly-cli/docs/commands/schedule/update/>shelly schedule update</a></li></ul></details></li><li><details><summary>shelly script</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/script/create/>shelly script create</a></li><li><a href=/shelly-cli/docs/commands/script/delete/>shelly script delete</a></li><li><a href=/shelly-cli/docs/commands/script/download/>shelly script download</a></li><li><a href=/shelly-cli/docs/commands/script/eval/>shelly script eval</a></li><li><a href=/shelly-cli/docs/commands/script/get/>shelly script get</a></li><li><a href=/shelly-cli/docs/commands/script/list/>shelly script list</a></li><li><a href=/shelly-cli/docs/commands/script/start/>shelly script start</a></li><li><a href=/shelly-cli/docs/commands/script/stop/>shelly script stop</a></li><li><a href=/shelly-cli/docs/commands/script/template/>shelly script template</a></li><li><a href=/shelly-cli/docs/commands/script/template-install/>shelly script template install</a></li><li><a href=/shelly-cli/docs/commands/script/template-list/>shelly script template list</a></li><li><a href=/shelly-cli/docs/commands/script/template-show/>shelly script template show</a></li><li><a href=/shelly-cli/docs/commands/script/update/>shelly script update</a></li><li><a href=/shelly-cli/docs/commands/script/upload/>shelly script upload</a></li></ul></details></li><li><details><summary>shelly sensor</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/sensor/devicepower/>shelly sensor devicepower</a></li><li><a href=/shelly-cli/docs/commands/sensor/devicepower-list/>shelly sensor devicepower list</a></li><li><a href=/shelly-cli/docs/commands/sensor/devicepower-status/>shelly sensor devicepower status</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood/>shelly sensor flood</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-list/>shelly sensor flood list</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-status/>shelly sensor flood status</a></li><li><a href=/shelly-cli/docs/commands/sensor/flood-test/>shelly sensor flood test</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity/>shelly sensor humidity</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity-list/>shelly sensor humidity list</a></li><li><a href=/shelly-cli/docs/commands/sensor/humidity-status/>shelly sensor humidity status</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance/>shelly sensor illuminance</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance-list/>shelly sensor illuminance list</a></li><li><a href=/shelly-cli/docs/commands/sensor/illuminance-status/>shelly sensor illuminance status</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke/>shelly sensor smoke</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-list/>shelly sensor smoke list</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-mute/>shelly sensor smoke mute</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-status/>shelly sensor smoke status</a></li><li><a href=/shelly-cli/docs/commands/sensor/smoke-test/>shelly sensor smoke test</a></li><li><a href=/shelly-cli/docs/commands/sensor/status/>shelly sensor status</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature/>shelly sensor temperature</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature-list/>shelly sensor temperature list</a></li><li><a href=/shelly-cli/docs/commands/sensor/temperature-status/>shelly sensor temperature status</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter/>shelly sensor voltmeter</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter-list/>shelly sensor voltmeter list</a></li><li><a href=/shelly-cli/docs/commands/sensor/voltmeter-status/>shelly sensor voltmeter status</a></li></ul></details></li><li><details><summary>shelly sensoraddon</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/sensoraddon/add/>shelly sensoraddon add</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/list/>shelly sensoraddon list</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/remove/>shelly sensoraddon remove</a></li><li><a href=/shelly-cli/docs/commands/sensoraddon/scan/>shelly sensoraddon scan</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/shell/>shelly shell</a></li><li><a href=/shelly-cli/docs/commands/sleep/>shelly sleep</a></li><li><a href=/shelly-cli/docs/commands/status/>shelly status</a></li><li><details><summary>shelly switch</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/switch/list/>shelly switch list</a></li><li><a href=/shelly-cli/docs/commands/switch/off/>shelly switch off</a></li><li><a href=/shelly-cli/docs/commands/switch/on/>shelly switch on</a></li><li><a href=/shelly-cli/docs/commands/switch/status/>shelly switch status</a></li><li><a href=/shelly-cli/docs/commands/switch/toggle/>shelly switch toggle</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/sync/>shelly sync</a></li><li><details><summary>shelly template</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/template/apply/>shelly template apply</a></li><li><a href=/shelly-cli/docs/commands/template/create/>shelly template create</a></li><li><a href=/shelly-cli/docs/commands/template/delete/>shelly template delete</a></li><li><a href=/shelly-cli/docs/commands/template/diff/>shelly template diff</a></li><li><a href=/shelly-cli/docs/commands/template/export/>shelly template export</a></li><li><a href=/shelly-cli/docs/commands/template/import/>shelly template import</a></li><li><a href=/shelly-cli/docs/commands/template/list/>shelly template list</a></li></ul></details></li><li><details><summary>shelly theme</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/theme/current/>shelly theme current</a></li><li><a href=/shelly-cli/docs/commands/theme/export/>shelly theme export</a></li><li><a href=/shelly-cli/docs/commands/theme/import/>shelly theme import</a></li><li><a href=/shelly-cli/docs/commands/theme/list/>shelly theme list</a></li><li><a href=/shelly-cli/docs/commands/theme/next/>shelly theme next</a></li><li><a href=/shelly-cli/docs/commands/theme/prev/>shelly theme prev</a></li><li><a href=/shelly-cli/docs/commands/theme/preview/>shelly theme preview</a></li><li><a href=/shelly-cli/docs/commands/theme/semantic/>shelly theme semantic</a></li><li><a href=/shelly-cli/docs/commands/theme/set/>shelly theme set</a></li></ul></details></li><li><details><summary>shelly thermostat</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/thermostat/boost/>shelly thermostat boost</a></li><li><a href=/shelly-cli/docs/commands/thermostat/calibrate/>shelly thermostat calibrate</a></li><li><a href=/shelly-cli/docs/commands/thermostat/disable/>shelly thermostat disable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/enable/>shelly thermostat enable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/list/>shelly thermostat list</a></li><li><a href=/shelly-cli/docs/commands/thermostat/override/>shelly thermostat override</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule/>shelly thermostat schedule</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-create/>shelly thermostat schedule create</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-delete/>shelly thermostat schedule delete</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-disable/>shelly thermostat schedule disable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-enable/>shelly thermostat schedule enable</a></li><li><a href=/shelly-cli/docs/commands/thermostat/schedule-list/>shelly thermostat schedule list</a></li><li><a href=/shelly-cli/docs/commands/thermostat/set/>shelly thermostat set</a></li><li><a href=/shelly-cli/docs/commands/thermostat/status/>shelly thermostat status</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/toggle/>shelly toggle</a></li><li><a href=/shelly-cli/docs/commands/update/>shelly update</a></li><li><a href=/shelly-cli/docs/commands/version/>shelly version</a></li><li><details><summary>shelly virtual</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/virtual/create/>shelly virtual create</a></li><li><a href=/shelly-cli/docs/commands/virtual/delete/>shelly virtual delete</a></li><li><a href=/shelly-cli/docs/commands/virtual/get/>shelly virtual get</a></li><li><a href=/shelly-cli/docs/commands/virtual/list/>shelly virtual list</a></li><li><a href=/shelly-cli/docs/commands/virtual/set/>shelly virtual set</a></li></ul></details></li><li><a href=/shelly-cli/docs/commands/wait/>shelly wait</a></li><li><a href=/shelly-cli/docs/commands/wake/>shelly wake</a></li><li><details><summary>shelly webhook</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/webhook/create/>shelly webhook create</a></li><li><a href=/shelly-cli/docs/commands/webhook/delete/>shelly webhook delete</a></li><li><a href=/shelly-cli/docs/commands/webhook/list/>shelly webhook list</a></li><li><a href=/shelly-cli/docs/commands/webhook/server/>shelly webhook server</a></li><li><a href=/shelly-cli/docs/commands/webhook/update/>shelly webhook update</a></li></ul></details></li><li><details><summary>shelly wifi</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/wifi/ap/>shelly wifi ap</a></li><li><a href=/shelly-cli/docs/commands/wifi/scan/>shelly wifi scan</a></li><li><a href=/shelly-cli/docs/commands/wifi/set/>shelly wifi set</a></li><li><a href=/shelly-cli/docs/commands/wifi/status/>shelly wifi status</a></li></ul></details></li><li><details><summary>shelly zigbee</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/zigbee/list/>shelly zigbee list</a></li><li><a href=/shelly-cli/docs/commands/zigbee/pair/>shelly zigbee pair</a></li><li><a href=/shelly-cli/docs/commands/zigbee/remove/>shelly zigbee remove</a></li><li><a href=/shelly-cli/docs/commands/zigbee/status/>shelly zigbee status</a></li></ul></details></li><li><details><summary>shelly zwave</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/commands/zwave/config/>shelly zwave config</a></li><li><a href=/shelly-cli/docs/commands/zwave/exclusion/>shelly zwave exclusion</a></li><li><a href=/shelly-cli/docs/commands/zwave/inclusion/>shelly zwave inclusion</a></li><li><a href=/shelly-cli/docs/commands/zwave/info/>shelly zwave info</a></li><li><a href=/shelly-cli/docs/commands/zwave/reset/>shelly zwave reset</a></li></ul></details></li></ul></details></li><li><a href=/shelly-cli/docs/configuration/>Configuration Reference</a></li><li><details open><summary>Guides</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/guides/tui-dashboard/>TUI Dashboard</a></li><li><a href=/shelly-cli/docs/guides/tasmota/>Tasmota Devices</a></li></ul></details></li><li><a href=/shelly-cli/docs/plugins/>Plugin System</a></li><li><a href=/shelly-cli/docs/themes/>Theme System</a></li><li><details open><summary>Reference</summary><ul class="list-unstyled list-nested"><li><a href=/shelly-cli/docs/reference/architecture/>Project Architecture</a></li><li><a href=/shelly-cli/docs/reference/dependencies/>Dependencies</a></li></ul></details></li><li><details open open><summary>Contributing</summary><ul class="list-unstyled list-nested"><li class=active><a aria-current=page href=/shelly-cli/docs/contributing/development/>Development Guide</a></li><li><a href=/shelly-cli/docs/contributing/testing/>Testing Strategy</a></li></ul></details></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#table-of-contents>Table of Contents</a><ul><li><a href=#development-standards>Development Standards</a></li><li><a href=#reference-patterns>Reference Patterns</a></li></ul></li></ul><ul><li><a href=#command-development-standards>Command Development Standards</a><ul><li><a href=#options-struct-pattern>Options Struct Pattern</a></li><li><a href=#constructor-naming>Constructor Naming</a></li><li><a href=#factory-parameter>Factory Parameter</a></li><li><a href=#parent-child-command-structure>Parent-Child Command Structure</a></li></ul></li><li><a href=#factory-usage>Factory Usage</a><ul><li><a href=#what-the-factory-provides>What the Factory Provides</a></li><li><a href=#accessing-dependencies>Accessing Dependencies</a></li><li><a href=#why-these-design-choices>Why These Design Choices</a></li></ul></li><li><a href=#iostreams-usage>IOStreams Usage</a><ul><li><a href=#standard-pattern>Standard Pattern</a></li><li><a href=#progress-indicators>Progress Indicators</a></li><li><a href=#available-iostreams-methods>Available IOStreams Methods</a></li></ul></li><li><a href=#error-handling>Error Handling</a><ul><li><a href=#standard-pattern-1>Standard Pattern</a></li><li><a href=#error-wrapping>Error Wrapping</a></li></ul></li><li><a href=#context-propagation>Context Propagation</a><ul><li><a href=#context-flow>Context Flow</a></li><li><a href=#rules>Rules</a></li></ul></li><li><a href=#import-organization>Import Organization</a><ul><li><a href=#gci-compliant-ordering>gci-Compliant Ordering</a></li></ul></li><li><a href=#anti-patterns-to-avoid>Anti-Patterns to Avoid</a><ul><li><a href=#1-direct-instantiation>1. Direct Instantiation</a></li><li><a href=#2-creating-context-in-commands>2. Creating Context in Commands</a></li><li><a href=#3-package-level-iostreams-calls>3. Package-Level IOStreams Calls</a></li><li><a href=#4-manual-spinner-management>4. Manual Spinner Management</a></li></ul></li><li><a href=#migration-checklist>Migration Checklist</a></li><li><a href=#reference-implementations>Reference Implementations</a></li></ul><ul><li><a href=#factory-pattern>Factory Pattern</a><ul><li><a href=#why-use-factory>Why Use Factory?</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#usage-in-commands>Usage in Commands</a></li></ul></li><li><a href=#iostreams-pattern>IOStreams Pattern</a><ul><li><a href=#why-use-iostreams>Why Use IOStreams?</a></li><li><a href=#implementation-1>Implementation</a></li><li><a href=#test-helper>Test Helper</a></li></ul></li><li><a href=#command-utilities>Command Utilities</a><ul><li><a href=#generic-command-runner>Generic Command Runner</a></li><li><a href=#output-format-routing>Output Format Routing</a></li><li><a href=#shared-flag-helpers>Shared Flag Helpers</a></li></ul></li><li><a href=#directory-structure>Directory Structure</a><ul><li><a href=#key-principle-commands-only-under-internalcmd>Key Principle: Commands Only Under <code>internal/cmd/</code></a></li><li><a href=#command-structure-pattern>Command Structure Pattern</a></li></ul></li><li><a href=#tui-architecture>TUI Architecture</a><ul><li><a href=#component-structure>Component Structure</a></li><li><a href=#component-implementation>Component Implementation</a></li><li><a href=#async-data-fetching>Async Data Fetching</a></li></ul></li><li><a href=#multi-writer-output-pattern>Multi-Writer Output Pattern</a><ul><li><a href=#why-multi-writer>Why Multi-Writer?</a></li><li><a href=#implementation-with-lipgloss>Implementation with lipgloss</a></li><li><a href=#usage-in-batch-operations>Usage in Batch Operations</a></li><li><a href=#example-output>Example Output</a></li><li><a href=#opportunities-in-shelly-cli>Opportunities in shelly-cli</a></li></ul></li><li><a href=#concurrency-patterns>Concurrency Patterns</a><ul><li><a href=#waitgroupgo-go-125---fire-and-forget>WaitGroup.Go() (Go 1.25+) - Fire and Forget</a></li><li><a href=#errgroup---error-propagation--concurrency-limits>errgroup - Error Propagation & Concurrency Limits</a></li><li><a href=#context-propagation-1>Context Propagation</a></li></ul></li><li><a href=#testing-patterns>Testing Patterns</a><ul><li><a href=#tui-testing-with-teatest>TUI Testing with teatest</a></li><li><a href=#table-driven-tests>Table-Driven Tests</a></li><li><a href=#mock-factory>Mock Factory</a></li></ul></li><li><a href=#references>References</a><ul><li><a href=#cli-architecture>CLI Architecture</a></li><li><a href=#tui-frameworks>TUI Frameworks</a></li><li><a href=#tui-examples>TUI Examples</a></li><li><a href=#testing>Testing</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Development Guide</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a><ul><li><a href=#development-standards>Development Standards</a></li><li><a href=#reference-patterns>Reference Patterns</a></li></ul></li></ul><ul><li><a href=#command-development-standards>Command Development Standards</a><ul><li><a href=#options-struct-pattern>Options Struct Pattern</a></li><li><a href=#constructor-naming>Constructor Naming</a></li><li><a href=#factory-parameter>Factory Parameter</a></li><li><a href=#parent-child-command-structure>Parent-Child Command Structure</a></li></ul></li><li><a href=#factory-usage>Factory Usage</a><ul><li><a href=#what-the-factory-provides>What the Factory Provides</a></li><li><a href=#accessing-dependencies>Accessing Dependencies</a></li><li><a href=#why-these-design-choices>Why These Design Choices</a></li></ul></li><li><a href=#iostreams-usage>IOStreams Usage</a><ul><li><a href=#standard-pattern>Standard Pattern</a></li><li><a href=#progress-indicators>Progress Indicators</a></li><li><a href=#available-iostreams-methods>Available IOStreams Methods</a></li></ul></li><li><a href=#error-handling>Error Handling</a><ul><li><a href=#standard-pattern-1>Standard Pattern</a></li><li><a href=#error-wrapping>Error Wrapping</a></li></ul></li><li><a href=#context-propagation>Context Propagation</a><ul><li><a href=#context-flow>Context Flow</a></li><li><a href=#rules>Rules</a></li></ul></li><li><a href=#import-organization>Import Organization</a><ul><li><a href=#gci-compliant-ordering>gci-Compliant Ordering</a></li></ul></li><li><a href=#anti-patterns-to-avoid>Anti-Patterns to Avoid</a><ul><li><a href=#1-direct-instantiation>1. Direct Instantiation</a></li><li><a href=#2-creating-context-in-commands>2. Creating Context in Commands</a></li><li><a href=#3-package-level-iostreams-calls>3. Package-Level IOStreams Calls</a></li><li><a href=#4-manual-spinner-management>4. Manual Spinner Management</a></li></ul></li><li><a href=#migration-checklist>Migration Checklist</a></li><li><a href=#reference-implementations>Reference Implementations</a></li></ul><ul><li><a href=#factory-pattern>Factory Pattern</a><ul><li><a href=#why-use-factory>Why Use Factory?</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#usage-in-commands>Usage in Commands</a></li></ul></li><li><a href=#iostreams-pattern>IOStreams Pattern</a><ul><li><a href=#why-use-iostreams>Why Use IOStreams?</a></li><li><a href=#implementation-1>Implementation</a></li><li><a href=#test-helper>Test Helper</a></li></ul></li><li><a href=#command-utilities>Command Utilities</a><ul><li><a href=#generic-command-runner>Generic Command Runner</a></li><li><a href=#output-format-routing>Output Format Routing</a></li><li><a href=#shared-flag-helpers>Shared Flag Helpers</a></li></ul></li><li><a href=#directory-structure>Directory Structure</a><ul><li><a href=#key-principle-commands-only-under-internalcmd>Key Principle: Commands Only Under <code>internal/cmd/</code></a></li><li><a href=#command-structure-pattern>Command Structure Pattern</a></li></ul></li><li><a href=#tui-architecture>TUI Architecture</a><ul><li><a href=#component-structure>Component Structure</a></li><li><a href=#component-implementation>Component Implementation</a></li><li><a href=#async-data-fetching>Async Data Fetching</a></li></ul></li><li><a href=#multi-writer-output-pattern>Multi-Writer Output Pattern</a><ul><li><a href=#why-multi-writer>Why Multi-Writer?</a></li><li><a href=#implementation-with-lipgloss>Implementation with lipgloss</a></li><li><a href=#usage-in-batch-operations>Usage in Batch Operations</a></li><li><a href=#example-output>Example Output</a></li><li><a href=#opportunities-in-shelly-cli>Opportunities in shelly-cli</a></li></ul></li><li><a href=#concurrency-patterns>Concurrency Patterns</a><ul><li><a href=#waitgroupgo-go-125---fire-and-forget>WaitGroup.Go() (Go 1.25+) - Fire and Forget</a></li><li><a href=#errgroup---error-propagation--concurrency-limits>errgroup - Error Propagation & Concurrency Limits</a></li><li><a href=#context-propagation-1>Context Propagation</a></li></ul></li><li><a href=#testing-patterns>Testing Patterns</a><ul><li><a href=#tui-testing-with-teatest>TUI Testing with teatest</a></li><li><a href=#table-driven-tests>Table-Driven Tests</a></li><li><a href=#mock-factory>Mock Factory</a></li></ul></li><li><a href=#references>References</a><ul><li><a href=#cli-architecture>CLI Architecture</a></li><li><a href=#tui-frameworks>TUI Frameworks</a></li><li><a href=#tui-examples>TUI Examples</a></li><li><a href=#testing>Testing</a></li></ul></li></ul></nav></div></details></nav><p>This document provides development standards and architectural patterns for the shelly-cli codebase. The first half covers practical coding standards; the second half provides reference patterns derived from audits of gh, kubectl, docker, jira-cli, gh-dash, and k9s.</p><h2 id=table-of-contents>Table of Contents<a href=#table-of-contents class=anchor aria-hidden=true>#</a></h2><h3 id=development-standards>Development Standards<a href=#development-standards class=anchor aria-hidden=true>#</a></h3><ol><li><a href=#command-development-standards>Command Development Standards</a></li><li><a href=#factory-usage>Factory Usage</a></li><li><a href=#iostreams-usage>IOStreams Usage</a></li><li><a href=#error-handling>Error Handling</a></li><li><a href=#context-propagation>Context Propagation</a></li><li><a href=#import-organization>Import Organization</a></li><li><a href=#anti-patterns-to-avoid>Anti-Patterns to Avoid</a></li><li><a href=#migration-checklist>Migration Checklist</a></li><li><a href=#reference-implementations>Reference Implementations</a></li></ol><h3 id=reference-patterns>Reference Patterns<a href=#reference-patterns class=anchor aria-hidden=true>#</a></h3><ol start=10><li><a href=#factory-pattern>Factory Pattern (gh/kubectl)</a></li><li><a href=#iostreams-pattern>IOStreams Pattern (gh)</a></li><li><a href=#command-utilities>Command Utilities (gh/kubectl/jira-cli)</a></li><li><a href=#directory-structure>Directory Structure</a></li><li><a href=#tui-architecture>TUI Architecture (gh-dash/BubbleTea)</a></li><li><a href=#multi-writer-output-pattern>Multi-Writer Output Pattern</a></li><li><a href=#concurrency-patterns>Concurrency Patterns</a></li><li><a href=#testing-patterns>Testing Patterns</a></li></ol><hr><h1 id=development-standards-1>Development Standards</h1><p>These standards apply to all code in the shelly-cli repository.</p><hr><h2 id=command-development-standards>Command Development Standards<a href=#command-development-standards class=anchor aria-hidden=true>#</a></h2><h3 id=options-struct-pattern>Options Struct Pattern<a href=#options-struct-pattern class=anchor aria-hidden=true>#</a></h3><p><strong>Standard</strong>: All commands with options MUST embed <code>Factory *cmdutil.Factory</code> in the Options struct.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct - Factory embedded in Options</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Options <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 1. Embedded flag groups (alphabetical)</span>
</span></span><span style=display:flex><span>    flags.ConfirmFlags
</span></span><span style=display:flex><span>    flags.OutputFlags
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 2. Factory (always present)</span>
</span></span><span style=display:flex><span>    Factory <span style=color:#ff79c6>*</span>cmdutil.Factory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 3. Command-specific fields (alphabetical)</span>
</span></span><span style=display:flex><span>    Device <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    ID     <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    opts <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>Options{Factory: f}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cmd <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{
</span></span><span style=display:flex><span>        Use: <span style=color:#f1fa8c>&#34;example &lt;device&gt;&#34;</span>,
</span></span><span style=display:flex><span>        RunE: <span style=color:#8be9fd;font-style:italic>func</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, args []<span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            opts.Device = args[<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>run</span>(cmd.<span style=color:#50fa7b>Context</span>(), opts)  <span style=color:#6272a4>// Only pass opts</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> cmd
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()   <span style=color:#6272a4>// Access from opts</span>
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect - Factory passed separately</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Options <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    Device <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    ID     <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, f <span style=color:#ff79c6>*</span>cmdutil.Factory, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {  <span style=color:#6272a4>// DON&#39;T DO THIS</span>
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> f.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Rationale</strong>:</p><ul><li>Consistent pattern across all commands (71 files already follow this)</li><li>Simplifies <code>run()</code> function signatures</li><li>Options struct becomes self-contained with all dependencies</li><li>Easier to test - mock factory can be injected into Options</li></ul><h3 id=constructor-naming>Constructor Naming<a href=#constructor-naming class=anchor aria-hidden=true>#</a></h3><p><strong>Standard</strong>: All command constructors must be named <code>NewCommand</code>.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{<span style=color:#ff79c6>...</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCmd</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{<span style=color:#ff79c6>...</span>}
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Rationale</strong>: Consistency with Cobra conventions and better IDE autocomplete.</p><h3 id=factory-parameter>Factory Parameter<a href=#factory-parameter class=anchor aria-hidden=true>#</a></h3><p><strong>Required</strong>: All command constructors MUST accept <code>*cmdutil.Factory</code> as the first parameter and embed it in Options.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct - Factory in Options</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    opts <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>Options{Factory: f}
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{
</span></span><span style=display:flex><span>        Use:   <span style=color:#f1fa8c>&#34;example &lt;device&gt;&#34;</span>,
</span></span><span style=display:flex><span>        Short: <span style=color:#f1fa8c>&#34;Example command&#34;</span>,
</span></span><span style=display:flex><span>        RunE: <span style=color:#8be9fd;font-style:italic>func</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, args []<span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            opts.Device = args[<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>run</span>(cmd.<span style=color:#50fa7b>Context</span>(), opts)  <span style=color:#6272a4>// Pass opts, NOT f</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect - No factory parameter</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>() <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{<span style=color:#ff79c6>...</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect - Factory passed separately to run()</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, f <span style=color:#ff79c6>*</span>cmdutil.Factory, device <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {  <span style=color:#6272a4>// DON&#39;T DO THIS</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Rationale</strong>:</p><ul><li>Enables dependency injection for testing</li><li>Provides consistent access to IOStreams, Config, and ShellyService</li><li>Prevents direct instantiation anti-pattern (<code>iostreams.System()</code>, <code>shelly.NewService()</code>)</li></ul><h3 id=parent-child-command-structure>Parent-Child Command Structure<a href=#parent-child-command-structure class=anchor aria-hidden=true>#</a></h3><p>Parent commands create the factory once and pass it to all children.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// Parent command</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    cmd <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{
</span></span><span style=display:flex><span>        Use:   <span style=color:#f1fa8c>&#34;device&#34;</span>,
</span></span><span style=display:flex><span>        Short: <span style=color:#f1fa8c>&#34;Device operations&#34;</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Pass factory to all subcommands</span>
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>AddCommand</span>(info.<span style=color:#50fa7b>NewCommand</span>(f))
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>AddCommand</span>(status.<span style=color:#50fa7b>NewCommand</span>(f))
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>AddCommand</span>(reboot.<span style=color:#50fa7b>NewCommand</span>(f))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> cmd
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Never</strong> create a new factory in child commands - always use the one passed from parent.</p><hr><h2 id=factory-usage>Factory Usage<a href=#factory-usage class=anchor aria-hidden=true>#</a></h2><h3 id=what-the-factory-provides>What the Factory Provides<a href=#what-the-factory-provides class=anchor aria-hidden=true>#</a></h3><p>The factory provides three core dependencies:</p><ol><li><strong>IOStreams</strong> - Terminal I/O with progress indicators, colors, prompts</li><li><strong>Config</strong> - CLI configuration (devices, aliases, groups, scenes)</li><li><strong>ShellyService</strong> - Business logic for device operations</li></ol><h3 id=accessing-dependencies>Accessing Dependencies<a href=#accessing-dependencies class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Get dependencies from factory via opts</span>
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Use dependencies</span>
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StartProgress</span>(<span style=color:#f1fa8c>&#34;Processing...&#34;</span>)
</span></span><span style=display:flex><span>    err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, opts.Device, <span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Device rebooted&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=why-these-design-choices>Why These Design Choices<a href=#why-these-design-choices class=anchor aria-hidden=true>#</a></h3><p><strong>Q: Why doesn&rsquo;t the factory provide a raw Shelly HTTP client?</strong>
<strong>A:</strong> Shelly clients are device-specific (require IP/hostname). The factory provides the <code>ShellyService</code> which handles device resolution from names/IPs.</p><p><strong>Q: Why doesn&rsquo;t the factory have an embedded context?</strong>
<strong>A:</strong> Contexts are request-scoped (one per command execution), while the factory is application-scoped (singleton). Mixing lifetimes breaks cancellation semantics.</p><p><strong>Q: Why must factory be used in ALL commands?</strong>
<strong>A:</strong> Consistency and testability. Direct instantiation (<code>iostreams.System()</code>) bypasses dependency injection and makes testing difficult.</p><hr><h2 id=iostreams-usage>IOStreams Usage<a href=#iostreams-usage class=anchor aria-hidden=true>#</a></h2><h3 id=standard-pattern>Standard Pattern<a href=#standard-pattern class=anchor aria-hidden=true>#</a></h3><p><strong>Always</strong> use factory IOStreams methods, <strong>never</strong> package-level functions.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct - Instance methods via Options</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StartProgress</span>(<span style=color:#f1fa8c>&#34;Processing...&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ... work ...</span>
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Operation completed&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect - Package functions</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, device <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    spin <span style=color:#ff79c6>:=</span> iostreams.<span style=color:#50fa7b>NewSpinner</span>(<span style=color:#f1fa8c>&#34;Processing...&#34;</span>)
</span></span><span style=display:flex><span>    spin.<span style=color:#50fa7b>Start</span>()
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ... work ...</span>
</span></span><span style=display:flex><span>    spin.<span style=color:#50fa7b>Stop</span>()
</span></span><span style=display:flex><span>    iostreams.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Operation completed&#34;</span>) <span style=color:#6272a4>// âŒ Can&#39;t be mocked in tests</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=progress-indicators>Progress Indicators<a href=#progress-indicators class=anchor aria-hidden=true>#</a></h3><p>Use <code>StartProgress</code>/<code>StopProgress</code> instead of creating spinners directly.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct</span>
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>StartProgress</span>(<span style=color:#f1fa8c>&#34;Rebooting device...&#34;</span>)
</span></span><span style=display:flex><span>err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, device, delay)
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Incorrect - Old pattern</span>
</span></span><span style=display:flex><span>spin <span style=color:#ff79c6>:=</span> iostreams.<span style=color:#50fa7b>NewSpinner</span>(<span style=color:#f1fa8c>&#34;Rebooting device...&#34;</span>)
</span></span><span style=display:flex><span>spin.<span style=color:#50fa7b>Start</span>()
</span></span><span style=display:flex><span>err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, device, delay)
</span></span><span style=display:flex><span>spin.<span style=color:#50fa7b>Stop</span>()</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=available-iostreams-methods>Available IOStreams Methods<a href=#available-iostreams-methods class=anchor aria-hidden=true>#</a></h3><ul><li><strong>Progress</strong>: <code>StartProgress(msg)</code>, <code>StopProgress()</code></li><li><strong>Output</strong>: <code>Printf()</code>, <code>Println()</code>, <code>Title()</code>, <code>Info()</code>, <code>Warning()</code>, <code>Error()</code></li><li><strong>Success/Failure</strong>: <code>Success()</code>, <code>NoResults()</code>, <code>Added()</code></li><li><strong>Prompts</strong>: <code>Confirm()</code>, <code>Prompt()</code></li><li><strong>Debug</strong>: <code>DebugErr()</code></li></ul><hr><h2 id=error-handling>Error Handling<a href=#error-handling class=anchor aria-hidden=true>#</a></h2><h3 id=standard-pattern-1>Standard Pattern<a href=#standard-pattern-1 class=anchor aria-hidden=true>#</a></h3><p>Use separate declaration for readability and debugging.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âœ… Correct</span>
</span></span><span style=display:flex><span>err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, device, delay)
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;failed to reboot device: %w&#34;</span>, err)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âŒ Avoid - Inline pattern (except for simple parsing)</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, device, delay); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;failed to reboot device: %w&#34;</span>, err)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Exception</strong>: Inline error handling is acceptable for <code>fmt.Sscanf</code> and simple parsing operations.</p><h3 id=error-wrapping>Error Wrapping<a href=#error-wrapping class=anchor aria-hidden=true>#</a></h3><p>Always wrap errors with context using <code>%w</code> verb for error chains.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff79c6>return</span> fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;failed to reboot device: %w&#34;</span>, err)</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=context-propagation>Context Propagation<a href=#context-propagation class=anchor aria-hidden=true>#</a></h2><h3 id=context-flow>Context Flow<a href=#context-flow class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>Root Command (creates <span style=color:#ff79c6>signal</span><span style=color:#ff79c6>-</span>aware context)
</span></span><span style=display:flex><span>    â†“
</span></span><span style=display:flex><span>cmd<span style=color:#ff79c6>.</span>Context() passed to RunE
</span></span><span style=display:flex><span>    â†“
</span></span><span style=display:flex><span>run(ctx, opts)
</span></span><span style=display:flex><span>    â†“
</span></span><span style=display:flex><span>Service calls (svc<span style=color:#ff79c6>.</span>DeviceReboot(ctx, <span style=color:#ff79c6>...</span>))</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=rules>Rules<a href=#rules class=anchor aria-hidden=true>#</a></h3><ol><li><strong>Root command</strong> creates context with <code>signal.NotifyContext</code> for Ctrl+C handling</li><li><strong>All commands</strong> use <code>cmd.Context()</code>, <strong>never</strong> <code>context.Background()</code></li><li><strong>Command timeouts</strong> wrap the passed context: <code>ctx, cancel := context.WithTimeout(ctx, shelly.DefaultTimeout)</code></li><li><strong>Always defer cancel()</strong> to prevent context leaks</li></ol><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Wrap context with timeout</span>
</span></span><span style=display:flex><span>    ctx, cancel <span style=color:#ff79c6>:=</span> context.<span style=color:#50fa7b>WithTimeout</span>(ctx, shelly.DefaultTimeout)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defer</span> <span style=color:#50fa7b>cancel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> svc.<span style=color:#50fa7b>DeviceReboot</span>(ctx, opts.Device, <span style=color:#bd93f9>0</span>) <span style=color:#6272a4>// âœ… Context propagates</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=import-organization>Import Organization<a href=#import-organization class=anchor aria-hidden=true>#</a></h2><h3 id=gci-compliant-ordering>gci-Compliant Ordering<a href=#gci-compliant-ordering class=anchor aria-hidden=true>#</a></h3><p>Imports must be organized in three groups with blank lines between:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 1. Standard library</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 2. Third-party packages</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/spf13/viper&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// 3. Internal packages</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/cmdutil&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/iostreams&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/shelly&#34;</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>Enforcement</strong>: <code>golangci-lint</code> with <code>gci</code> linter enforces this automatically.</p><hr><h2 id=anti-patterns-to-avoid>Anti-Patterns to Avoid<a href=#anti-patterns-to-avoid class=anchor aria-hidden=true>#</a></h2><h3 id=1-direct-instantiation>1. Direct Instantiation<a href=#1-direct-instantiation class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âŒ Never do this</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, device <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> iostreams.<span style=color:#50fa7b>System</span>()  <span style=color:#6272a4>// Bypasses factory</span>
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> shelly.<span style=color:#50fa7b>NewService</span>() <span style=color:#6272a4>// Bypasses factory</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âœ… Always use factory via Options</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=2-creating-context-in-commands>2. Creating Context in Commands<a href=#2-creating-context-in-commands class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âŒ Never create context.Background() in commands</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(device <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ctx <span style=color:#ff79c6>:=</span> context.<span style=color:#50fa7b>Background</span>() <span style=color:#6272a4>// Breaks Ctrl+C handling</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âœ… Always use passed context</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ctx comes from cmd.Context()</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=3-package-level-iostreams-calls>3. Package-Level IOStreams Calls<a href=#3-package-level-iostreams-calls class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âŒ Avoid package functions</span>
</span></span><span style=display:flex><span>iostreams.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Done&#34;</span>)
</span></span><span style=display:flex><span>iostreams.<span style=color:#50fa7b>Warning</span>(<span style=color:#f1fa8c>&#34;Watch out&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âœ… Use instance methods</span>
</span></span><span style=display:flex><span>ios <span style=color:#ff79c6>:=</span> f.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Done&#34;</span>)
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>Warning</span>(<span style=color:#f1fa8c>&#34;Watch out&#34;</span>)</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=4-manual-spinner-management>4. Manual Spinner Management<a href=#4-manual-spinner-management class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// âŒ Old pattern - manual spinner</span>
</span></span><span style=display:flex><span>spin <span style=color:#ff79c6>:=</span> iostreams.<span style=color:#50fa7b>NewSpinner</span>(<span style=color:#f1fa8c>&#34;Processing...&#34;</span>)
</span></span><span style=display:flex><span>spin.<span style=color:#50fa7b>Start</span>()
</span></span><span style=display:flex><span><span style=color:#6272a4>// work</span>
</span></span><span style=display:flex><span>spin.<span style=color:#50fa7b>Stop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// âœ… New pattern - factory IOStreams</span>
</span></span><span style=display:flex><span>ios <span style=color:#ff79c6>:=</span> f.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>StartProgress</span>(<span style=color:#f1fa8c>&#34;Processing...&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#6272a4>// work</span>
</span></span><span style=display:flex><span>ios.<span style=color:#50fa7b>StopProgress</span>()</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=migration-checklist>Migration Checklist<a href=#migration-checklist class=anchor aria-hidden=true>#</a></h2><p>When creating a new command or updating an existing one:</p><ul><li><input disabled type=checkbox> Command constructor named <code>NewCommand(f *cmdutil.Factory)</code></li><li><input disabled type=checkbox> Factory passed to all subcommands</li><li><input disabled type=checkbox> Dependencies accessed via factory (<code>f.IOStreams()</code>, <code>f.ShellyService()</code>, <code>f.Config()</code>)</li><li><input disabled type=checkbox> Context from <code>cmd.Context()</code>, not <code>context.Background()</code></li><li><input disabled type=checkbox> Progress indicators use <code>ios.StartProgress()/StopProgress()</code></li><li><input disabled type=checkbox> No package-level iostreams calls</li><li><input disabled type=checkbox> Imports organized in gci format (stdlib, third-party, internal)</li><li><input disabled type=checkbox> Errors wrapped with <code>%w</code> for context</li><li><input disabled type=checkbox> Helper functions used where applicable (DRY principle)</li></ul><hr><h2 id=reference-implementations>Reference Implementations<a href=#reference-implementations class=anchor aria-hidden=true>#</a></h2><p><strong>Well-architected examples to study</strong>:</p><ul><li><code>internal/cmd/energy/status/status.go</code> - Factory pattern, auto-detection logic</li><li><code>internal/cmd/backup/create/create.go</code> - Complex operations, multiple dependencies</li><li><code>internal/cmd/scene/activate/activate.go</code> - Batch operations with errgroup</li><li><code>internal/cmd/discover/ble/ble.go</code> - Context-aware discovery</li></ul><p><strong>Helper usage examples</strong>:</p><ul><li><code>internal/cmd/light/on/on.go</code> - RunSimple helper</li><li><code>internal/cmd/light/status/status.go</code> - RunStatus helper</li><li><code>internal/cmd/batch/command/command.go</code> - RunBatch helper</li></ul><hr><h1 id=reference-patterns-1>Reference Patterns</h1><p>The following sections document patterns from industry-standard CLI tools that guide the shelly-cli implementation.</p><hr><h2 id=factory-pattern>Factory Pattern<a href=#factory-pattern class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh CLI (<code>pkg/cmdutil/factory.go</code>), kubectl</p><p>The Factory pattern provides centralized dependency injection for commands. Instead of creating dependencies directly in each command, the Factory provides them lazily on demand.</p><h3 id=why-use-factory>Why Use Factory?<a href=#why-use-factory class=anchor aria-hidden=true>#</a></h3><ol><li><strong>Testability</strong>: Replace real dependencies with mocks</li><li><strong>Lazy Loading</strong>: Dependencies created only when needed</li><li><strong>Consistency</strong>: Single source for all dependencies</li><li><strong>Plugin Support</strong>: Plugins can receive the same dependencies</li></ol><h3 id=implementation>Implementation<a href=#implementation class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmdutil/factory.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> cmdutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/config&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/iostreams&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/shelly&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Factory provides dependencies to commands</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Factory <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Lazy initializers - called on first access</span>
</span></span><span style=display:flex><span>    IOStreams     <span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#ff79c6>*</span>iostreams.IOStreams
</span></span><span style=display:flex><span>    Config        <span style=color:#8be9fd;font-style:italic>func</span>() (<span style=color:#ff79c6>*</span>config.Config, <span style=color:#8be9fd>error</span>)
</span></span><span style=display:flex><span>    ShellyService <span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#ff79c6>*</span>shelly.Service
</span></span><span style=display:flex><span>    Browser       <span style=color:#8be9fd;font-style:italic>func</span>() browser.Browser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Cached instances (set after first call)</span>
</span></span><span style=display:flex><span>    ioStreams     <span style=color:#ff79c6>*</span>iostreams.IOStreams
</span></span><span style=display:flex><span>    cfg           <span style=color:#ff79c6>*</span>config.Config
</span></span><span style=display:flex><span>    shellyService <span style=color:#ff79c6>*</span>shelly.Service
</span></span><span style=display:flex><span>    browserInst   browser.Browser
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Factory also provides helper methods for common operations:</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - WithTimeout/WithDefaultTimeout - context timeout management</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - GetDevice/GetGroup/GetAlias - config accessor helpers</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - ResolveAddress/ResolveDevice - device name resolution</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - ExpandTargets - batch operation target expansion</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - ConfirmAction - user confirmation</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - OutputFormat/IsJSONOutput/IsYAMLOutput - output format helpers</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// - Logger - structured logging access</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// NewFactory creates a Factory with production dependencies</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewFactory</span>() <span style=color:#ff79c6>*</span>Factory {
</span></span><span style=display:flex><span>    f <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>Factory{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    f.IOStreams = <span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#ff79c6>*</span>iostreams.IOStreams {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> f.ioStreams <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>            f.ioStreams = iostreams.<span style=color:#50fa7b>System</span>()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> f.ioStreams
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    f.Config = <span style=color:#8be9fd;font-style:italic>func</span>() (<span style=color:#ff79c6>*</span>config.Config, <span style=color:#8be9fd>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> f.cfg <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>            cfg, err <span style=color:#ff79c6>:=</span> config.<span style=color:#50fa7b>Load</span>()
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>, err
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            f.cfg = cfg
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> f.cfg, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    f.ShellyService = <span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#ff79c6>*</span>shelly.Service {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> f.shellyService <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>            f.shellyService = shelly.<span style=color:#50fa7b>NewService</span>()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> f.shellyService
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> f
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=usage-in-commands>Usage in Commands<a href=#usage-in-commands class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmd/switch/on/on.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Options <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    Factory  <span style=color:#ff79c6>*</span>cmdutil.Factory
</span></span><span style=display:flex><span>    Device   <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    SwitchID <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    opts <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>Options{Factory: f}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cmd <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{
</span></span><span style=display:flex><span>        Use:     <span style=color:#f1fa8c>&#34;on &lt;device&gt;&#34;</span>,
</span></span><span style=display:flex><span>        Aliases: []<span style=color:#8be9fd>string</span>{<span style=color:#f1fa8c>&#34;enable&#34;</span>},
</span></span><span style=display:flex><span>        Short:   <span style=color:#f1fa8c>&#34;Turn switch on&#34;</span>,
</span></span><span style=display:flex><span>        Example: <span style=color:#f1fa8c>`  shelly switch on living-room
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  shelly switch on kitchen --id 1`</span>,
</span></span><span style=display:flex><span>        RunE: <span style=color:#8be9fd;font-style:italic>func</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, args []<span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            opts.Device = args[<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>run</span>(cmd.<span style=color:#50fa7b>Context</span>(), opts)
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>IntVarP</span>(<span style=color:#ff79c6>&amp;</span>opts.SwitchID, <span style=color:#f1fa8c>&#34;id&#34;</span>, <span style=color:#f1fa8c>&#34;i&#34;</span>, <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;Switch ID&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> cmd
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StartProgress</span>(<span style=color:#f1fa8c>&#34;Turning switch on...&#34;</span>)
</span></span><span style=display:flex><span>    err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>SwitchOn</span>(ctx, opts.Device, opts.SwitchID)
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;failed to turn switch on: %w&#34;</span>, err)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Switch %d turned on&#34;</span>, opts.SwitchID)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=iostreams-pattern>IOStreams Pattern<a href=#iostreams-pattern class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh CLI (<code>pkg/iostreams/iostreams.go</code>)</p><p>IOStreams provides a unified abstraction for terminal I/O, enabling consistent handling of color, TTY detection, progress indicators, and paging.</p><h3 id=why-use-iostreams>Why Use IOStreams?<a href=#why-use-iostreams class=anchor aria-hidden=true>#</a></h3><ol><li><strong>Testability</strong>: Capture output in tests</li><li><strong>TTY Detection</strong>: Adjust output based on terminal capabilities</li><li><strong>Color Management</strong>: Respect NO_COLOR, FORCE_COLOR, etc.</li><li><strong>Progress Indicators</strong>: Unified spinner/progress handling</li><li><strong>Paging</strong>: Automatic paging for long output</li></ol><h3 id=implementation-1>Implementation<a href=#implementation-1 class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">99
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/iostreams/iostreams.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> iostreams
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;os&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/briandowns/spinner&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/mattn/go-isatty&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// IOStreams holds I/O streams and terminal state</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> IOStreams <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    In     io.Reader
</span></span><span style=display:flex><span>    Out    io.Writer
</span></span><span style=display:flex><span>    ErrOut io.Writer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Terminal state (detected once)</span>
</span></span><span style=display:flex><span>    isStdinTTY  <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>    isStdoutTTY <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>    isStderrTTY <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Color settings</span>
</span></span><span style=display:flex><span>    colorEnabled     <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>    colorForced      <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Progress indicator</span>
</span></span><span style=display:flex><span>    progressIndicator <span style=color:#ff79c6>*</span>spinner.Spinner
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// System creates IOStreams connected to stdin/stdout/stderr</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>System</span>() <span style=color:#ff79c6>*</span>IOStreams {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>IOStreams{
</span></span><span style=display:flex><span>        In:     os.Stdin,
</span></span><span style=display:flex><span>        Out:    os.Stdout,
</span></span><span style=display:flex><span>        ErrOut: os.Stderr,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Detect TTY</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> f, ok <span style=color:#ff79c6>:=</span> os.Stdin.(<span style=color:#ff79c6>*</span>os.File); ok {
</span></span><span style=display:flex><span>        ios.isStdinTTY = isatty.<span style=color:#50fa7b>IsTerminal</span>(f.<span style=color:#50fa7b>Fd</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> f, ok <span style=color:#ff79c6>:=</span> os.Stdout.(<span style=color:#ff79c6>*</span>os.File); ok {
</span></span><span style=display:flex><span>        ios.isStdoutTTY = isatty.<span style=color:#50fa7b>IsTerminal</span>(f.<span style=color:#50fa7b>Fd</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> f, ok <span style=color:#ff79c6>:=</span> os.Stderr.(<span style=color:#ff79c6>*</span>os.File); ok {
</span></span><span style=display:flex><span>        ios.isStderrTTY = isatty.<span style=color:#50fa7b>IsTerminal</span>(f.<span style=color:#50fa7b>Fd</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Determine color settings</span>
</span></span><span style=display:flex><span>    ios.colorEnabled = ios.isStdoutTTY <span style=color:#ff79c6>&amp;&amp;</span> !<span style=color:#50fa7b>isColorDisabled</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> ios
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>isColorDisabled</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Check NO_COLOR (https://no-color.org/)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> _, ok <span style=color:#ff79c6>:=</span> os.<span style=color:#50fa7b>LookupEnv</span>(<span style=color:#f1fa8c>&#34;NO_COLOR&#34;</span>); ok {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Check SHELLY_NO_COLOR</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> _, ok <span style=color:#ff79c6>:=</span> os.<span style=color:#50fa7b>LookupEnv</span>(<span style=color:#f1fa8c>&#34;SHELLY_NO_COLOR&#34;</span>); ok {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// IsStdoutTTY returns true if stdout is a terminal</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (s <span style=color:#ff79c6>*</span>IOStreams) <span style=color:#50fa7b>IsStdoutTTY</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> s.isStdoutTTY
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// ColorEnabled returns true if color output is enabled</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (s <span style=color:#ff79c6>*</span>IOStreams) <span style=color:#50fa7b>ColorEnabled</span>() <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> s.colorEnabled
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// StartProgress starts a spinner with the given message</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (s <span style=color:#ff79c6>*</span>IOStreams) <span style=color:#50fa7b>StartProgress</span>(msg <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> !s.isStdoutTTY {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// No spinner for non-TTY, just print message</span>
</span></span><span style=display:flex><span>        fmt.<span style=color:#50fa7b>Fprintln</span>(s.ErrOut, msg)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s.progressIndicator = spinner.<span style=color:#50fa7b>New</span>(spinner.CharSets[<span style=color:#bd93f9>14</span>], <span style=color:#bd93f9>100</span><span style=color:#ff79c6>*</span>time.Millisecond)
</span></span><span style=display:flex><span>    s.progressIndicator.Suffix = <span style=color:#f1fa8c>&#34; &#34;</span> <span style=color:#ff79c6>+</span> msg
</span></span><span style=display:flex><span>    s.progressIndicator.Writer = s.ErrOut
</span></span><span style=display:flex><span>    s.progressIndicator.<span style=color:#50fa7b>Start</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// StopProgress stops the current spinner</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (s <span style=color:#ff79c6>*</span>IOStreams) <span style=color:#50fa7b>StopProgress</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> s.progressIndicator <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>        s.progressIndicator.<span style=color:#50fa7b>Stop</span>()
</span></span><span style=display:flex><span>        s.progressIndicator = <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=test-helper>Test Helper<a href=#test-helper class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/testutil/iostreams.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewTestIOStreams</span>() (<span style=color:#ff79c6>*</span>IOStreams, <span style=color:#ff79c6>*</span>bytes.Buffer, <span style=color:#ff79c6>*</span>bytes.Buffer) {
</span></span><span style=display:flex><span>    stdin <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>bytes.Buffer{}
</span></span><span style=display:flex><span>    stdout <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>bytes.Buffer{}
</span></span><span style=display:flex><span>    stderr <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>bytes.Buffer{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>IOStreams{
</span></span><span style=display:flex><span>        In:           stdin,
</span></span><span style=display:flex><span>        Out:          stdout,
</span></span><span style=display:flex><span>        ErrOut:       stderr,
</span></span><span style=display:flex><span>        colorEnabled: <span style=color:#ff79c6>false</span>, <span style=color:#6272a4>// Disable color in tests</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> ios, stdout, stderr
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=command-utilities>Command Utilities<a href=#command-utilities class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh (<code>pkg/cmdutil/</code>), kubectl, jira-cli (<code>internal/cmdutil/</code>, <code>internal/cmdcommon/</code>)</p><p>Shared utilities reduce duplication across commands.</p><h3 id=generic-command-runner>Generic Command Runner<a href=#generic-command-runner class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmdutil/runner.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> cmdutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;golang.org/x/sync/errgroup&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/iostreams&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/shelly&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// ComponentAction is a function that operates on a device component</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> ComponentAction <span style=color:#8be9fd;font-style:italic>func</span>(ctx context.Context, svc <span style=color:#ff79c6>*</span>shelly.Service, device <span style=color:#8be9fd>string</span>, id <span style=color:#8be9fd>int</span>) <span style=color:#8be9fd>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// RunWithSpinner executes an action with a progress spinner</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>RunWithSpinner</span>(ctx context.Context, ios <span style=color:#ff79c6>*</span>iostreams.IOStreams, msg <span style=color:#8be9fd>string</span>, action <span style=color:#8be9fd;font-style:italic>func</span>(context.Context) <span style=color:#8be9fd>error</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StartProgress</span>(msg)
</span></span><span style=display:flex><span>    err <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>action</span>(ctx)
</span></span><span style=display:flex><span>    ios.<span style=color:#50fa7b>StopProgress</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// RunBatch executes an action on multiple devices concurrently</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>RunBatch</span>(ctx context.Context, ios <span style=color:#ff79c6>*</span>iostreams.IOStreams, targets []<span style=color:#8be9fd>string</span>, concurrent <span style=color:#8be9fd>int</span>, action ComponentAction) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    g, ctx <span style=color:#ff79c6>:=</span> errgroup.<span style=color:#50fa7b>WithContext</span>(ctx)
</span></span><span style=display:flex><span>    g.<span style=color:#50fa7b>SetLimit</span>(concurrent)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> shelly.<span style=color:#50fa7b>NewService</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>        t <span style=color:#ff79c6>:=</span> target
</span></span><span style=display:flex><span>        g.<span style=color:#50fa7b>Go</span>(<span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>action</span>(ctx, svc, t, <span style=color:#bd93f9>0</span>); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#6272a4>// Log error but continue with other devices</span>
</span></span><span style=display:flex><span>                fmt.<span style=color:#50fa7b>Fprintf</span>(ios.ErrOut, <span style=color:#f1fa8c>&#34;Error on %s: %v\n&#34;</span>, t, err)
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span> <span style=color:#6272a4>// Don&#39;t fail the whole batch</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> g.<span style=color:#50fa7b>Wait</span>()
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=output-format-routing>Output Format Routing<a href=#output-format-routing class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmdutil/output.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> cmdutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;io&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/output&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// PrintResult outputs data in the specified format</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>PrintResult</span>(w io.Writer, format <span style=color:#8be9fd>string</span>, data <span style=color:#8be9fd>any</span>, tableFn <span style=color:#8be9fd;font-style:italic>func</span>(io.Writer, <span style=color:#8be9fd>any</span>)) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> format {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;json&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> output.<span style=color:#50fa7b>JSON</span>(w, data)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;yaml&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> output.<span style=color:#50fa7b>YAML</span>(w, data)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;template&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Template handled separately with template string</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#50fa7b>tableFn</span>(w, data)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=shared-flag-helpers>Shared Flag Helpers<a href=#shared-flag-helpers class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmdutil/flags.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> cmdutil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// AddComponentIDFlag adds the standard component ID flag</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>AddComponentIDFlag</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, target <span style=color:#ff79c6>*</span><span style=color:#8be9fd>int</span>, componentName <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>IntVarP</span>(target, <span style=color:#f1fa8c>&#34;id&#34;</span>, <span style=color:#f1fa8c>&#34;i&#34;</span>, <span style=color:#bd93f9>0</span>, fmt.<span style=color:#50fa7b>Sprintf</span>(<span style=color:#f1fa8c>&#34;%s ID (default 0)&#34;</span>, componentName))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// AddOutputFlag adds the standard output format flag</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>AddOutputFlag</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command) {
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>StringP</span>(<span style=color:#f1fa8c>&#34;output&#34;</span>, <span style=color:#f1fa8c>&#34;o&#34;</span>, <span style=color:#f1fa8c>&#34;table&#34;</span>, <span style=color:#f1fa8c>&#34;Output format (table, json, yaml, template)&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// AddTimeoutFlag adds a timeout flag</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>AddTimeoutFlag</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, target <span style=color:#ff79c6>*</span>time.Duration, defaultValue time.Duration) {
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>DurationVar</span>(target, <span style=color:#f1fa8c>&#34;timeout&#34;</span>, defaultValue, <span style=color:#f1fa8c>&#34;Operation timeout&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// AddConcurrencyFlag adds a concurrency flag for batch operations</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>AddConcurrencyFlag</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, target <span style=color:#ff79c6>*</span><span style=color:#8be9fd>int</span>) {
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>IntVarP</span>(target, <span style=color:#f1fa8c>&#34;parallel&#34;</span>, <span style=color:#f1fa8c>&#34;p&#34;</span>, <span style=color:#bd93f9>10</span>, <span style=color:#f1fa8c>&#34;Number of parallel operations&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=directory-structure>Directory Structure<a href=#directory-structure class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh (<code>pkg/cmd/</code>), docker (<code>cli/command/</code>), jira-cli (<code>internal/cmd/</code>)</p><h3 id=key-principle-commands-only-under-internalcmd>Key Principle: Commands Only Under <code>internal/cmd/</code><a href=#key-principle-commands-only-under-internalcmd class=anchor aria-hidden=true>#</a></h3><p>The <code>internal/cmd/</code> directory contains <strong>ONLY</strong> command definitions. All shared utilities, helpers, and infrastructure live elsewhere.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>internal/
</span></span><span style=display:flex><span>â”œâ”€â”€ cmd/                    # ONLY command definitions
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ root.go
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ switch/
</span></span><span style=display:flex><span>â”‚   â”‚   â”œâ”€â”€ switch.go       # Parent command
</span></span><span style=display:flex><span>â”‚   â”‚   â”œâ”€â”€ on/
</span></span><span style=display:flex><span>â”‚   â”‚   â”‚   â””â”€â”€ on.go       # `shelly switch on`
</span></span><span style=display:flex><span>â”‚   â”‚   â”œâ”€â”€ off/
</span></span><span style=display:flex><span>â”‚   â”‚   â”‚   â””â”€â”€ off.go      # `shelly switch off`
</span></span><span style=display:flex><span>â”‚   â”‚   â””â”€â”€ status/
</span></span><span style=display:flex><span>â”‚   â”‚       â””â”€â”€ status.go   # `shelly switch status`
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ ...
</span></span><span style=display:flex><span>â”‚
</span></span><span style=display:flex><span>â”œâ”€â”€ cmdutil/                # Command utilities (NOT under cmd/)
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ factory.go          # Dependency injection factory
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ runner.go           # RunWithSpinner, RunBatch helpers
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ flags.go            # Flag helpers (AddTimeoutFlag, etc.)
</span></span><span style=display:flex><span>â”‚
</span></span><span style=display:flex><span>â”œâ”€â”€ iostreams/              # I/O abstraction (NOT under cmd/)
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ iostreams.go        # IOStreams struct and methods
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ color.go            # Color detection and handling
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ progress.go         # Progress indicator management
</span></span><span style=display:flex><span>â”‚
</span></span><span style=display:flex><span>â”œâ”€â”€ browser/                # Cross-platform URL opening
</span></span><span style=display:flex><span>â”œâ”€â”€ config/                 # Configuration management
</span></span><span style=display:flex><span>â”œâ”€â”€ helpers/                # Device discovery and conversion helpers
</span></span><span style=display:flex><span>â”œâ”€â”€ model/                  # Domain models
</span></span><span style=display:flex><span>â”œâ”€â”€ output/                 # Output formatters (JSON, YAML, table)
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ format.go           # Format routing (WantsStructured, FormatOutput)
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ table.go            # Table formatting
</span></span><span style=display:flex><span>â”œâ”€â”€ shelly/                 # Business logic service layer
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ shelly.go           # Core service
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ quick.go            # Quick commands (QuickOn/Off/Toggle)
</span></span><span style=display:flex><span>â”‚   â”œâ”€â”€ devicedata.go       # Device data collection
</span></span><span style=display:flex><span>â”‚   â””â”€â”€ ...                 # Component-specific services
</span></span><span style=display:flex><span>â””â”€â”€ theme/                  # Theming (bubbletint integration)</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=command-structure-pattern>Command Structure Pattern<a href=#command-structure-pattern class=anchor aria-hidden=true>#</a></h3><p>Each command directory contains:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmd/switch/on/on.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> on
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/spf13/cobra&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/cmdutil&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Options holds the command options with Factory embedded.</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Options <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    Factory  <span style=color:#ff79c6>*</span>cmdutil.Factory
</span></span><span style=display:flex><span>    Device   <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    SwitchID <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// NewCommand creates the switch on command</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewCommand</span>(f <span style=color:#ff79c6>*</span>cmdutil.Factory) <span style=color:#ff79c6>*</span>cobra.Command {
</span></span><span style=display:flex><span>    opts <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>Options{Factory: f}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cmd <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>&amp;</span>cobra.Command{
</span></span><span style=display:flex><span>        Use:     <span style=color:#f1fa8c>&#34;on &lt;device&gt;&#34;</span>,
</span></span><span style=display:flex><span>        Aliases: []<span style=color:#8be9fd>string</span>{<span style=color:#f1fa8c>&#34;enable&#34;</span>},
</span></span><span style=display:flex><span>        Short:   <span style=color:#f1fa8c>&#34;Turn switch on&#34;</span>,
</span></span><span style=display:flex><span>        Long:    <span style=color:#f1fa8c>`Turn on a switch component on the specified device.`</span>,
</span></span><span style=display:flex><span>        Example: <span style=color:#f1fa8c>`  shelly switch on living-room
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  shelly switch on kitchen --id 1`</span>,
</span></span><span style=display:flex><span>        Args: cobra.<span style=color:#50fa7b>ExactArgs</span>(<span style=color:#bd93f9>1</span>),
</span></span><span style=display:flex><span>        RunE: <span style=color:#8be9fd;font-style:italic>func</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, args []<span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            opts.Device = args[<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>run</span>(cmd.<span style=color:#50fa7b>Context</span>(), opts)
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cmd.<span style=color:#50fa7b>Flags</span>().<span style=color:#50fa7b>IntVarP</span>(<span style=color:#ff79c6>&amp;</span>opts.SwitchID, <span style=color:#f1fa8c>&#34;id&#34;</span>, <span style=color:#f1fa8c>&#34;i&#34;</span>, <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;Switch ID&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> cmd
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, opts <span style=color:#ff79c6>*</span>Options) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ios <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>IOStreams</span>()
</span></span><span style=display:flex><span>    svc <span style=color:#ff79c6>:=</span> opts.Factory.<span style=color:#50fa7b>ShellyService</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> cmdutil.<span style=color:#50fa7b>RunWithSpinner</span>(ctx, ios, <span style=color:#f1fa8c>&#34;Turning switch on...&#34;</span>, <span style=color:#8be9fd;font-style:italic>func</span>(ctx context.Context) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>SwitchOn</span>(ctx, opts.Device, opts.SwitchID); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> fmt.<span style=color:#50fa7b>Errorf</span>(<span style=color:#f1fa8c>&#34;failed to turn switch on: %w&#34;</span>, err)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ios.<span style=color:#50fa7b>Success</span>(<span style=color:#f1fa8c>&#34;Switch %d turned on&#34;</span>, opts.SwitchID)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=tui-architecture>TUI Architecture<a href=#tui-architecture class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh-dash (dlvhdr/gh-dash), BubbleTea (charmbracelet/bubbletea)</p><p>The TUI uses the Elm Architecture via BubbleTea:</p><ul><li><strong>Model</strong>: Application state</li><li><strong>Init</strong>: Initial command (data fetching)</li><li><strong>Update</strong>: Handle messages, return new model + commands</li><li><strong>View</strong>: Render model to string</li></ul><h3 id=component-structure>Component Structure<a href=#component-structure class=anchor aria-hidden=true>#</a></h3><p>Each TUI component follows the same pattern:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>internal<span style=color:#ff79c6>/</span>tui<span style=color:#ff79c6>/</span>components<span style=color:#ff79c6>/</span>devicelist<span style=color:#ff79c6>/</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ model<span style=color:#ff79c6>.</span>go      <span style=color:#6272a4># Model struct and constructor</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ view<span style=color:#ff79c6>.</span>go       <span style=color:#6272a4># View() string method</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ update<span style=color:#ff79c6>.</span>go     <span style=color:#6272a4># Update(msg) method</span>
</span></span><span style=display:flex><span>â”œâ”€â”€ keys<span style=color:#ff79c6>.</span>go       <span style=color:#6272a4># Component-specific key bindings</span>
</span></span><span style=display:flex><span>â””â”€â”€ styles<span style=color:#ff79c6>.</span>go     <span style=color:#6272a4># Component styles</span></span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=component-implementation>Component Implementation<a href=#component-implementation class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/tui/components/devicelist/model.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> devicelist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/charmbracelet/bubbles/table&#34;</span>
</span></span><span style=display:flex><span>    tea <span style=color:#f1fa8c>&#34;github.com/charmbracelet/bubbletea&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/model&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Model holds the device list state</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Model <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    table    table.Model
</span></span><span style=display:flex><span>    devices  []model.Device
</span></span><span style=display:flex><span>    loading  <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>    err      <span style=color:#8be9fd>error</span>
</span></span><span style=display:flex><span>    width    <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>    height   <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// New creates a new device list model</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>New</span>() Model {
</span></span><span style=display:flex><span>    columns <span style=color:#ff79c6>:=</span> []table.Column{
</span></span><span style=display:flex><span>        {Title: <span style=color:#f1fa8c>&#34;Name&#34;</span>, Width: <span style=color:#bd93f9>20</span>},
</span></span><span style=display:flex><span>        {Title: <span style=color:#f1fa8c>&#34;IP&#34;</span>, Width: <span style=color:#bd93f9>15</span>},
</span></span><span style=display:flex><span>        {Title: <span style=color:#f1fa8c>&#34;Type&#34;</span>, Width: <span style=color:#bd93f9>15</span>},
</span></span><span style=display:flex><span>        {Title: <span style=color:#f1fa8c>&#34;Status&#34;</span>, Width: <span style=color:#bd93f9>10</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    t <span style=color:#ff79c6>:=</span> table.<span style=color:#50fa7b>New</span>(
</span></span><span style=display:flex><span>        table.<span style=color:#50fa7b>WithColumns</span>(columns),
</span></span><span style=display:flex><span>        table.<span style=color:#50fa7b>WithFocused</span>(<span style=color:#ff79c6>true</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> Model{
</span></span><span style=display:flex><span>        table:   t,
</span></span><span style=display:flex><span>        loading: <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Init returns the initial command</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m Model) <span style=color:#50fa7b>Init</span>() tea.Cmd {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>fetchDevices</span>()
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/tui/components/devicelist/update.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> devicelist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    tea <span style=color:#f1fa8c>&#34;github.com/charmbracelet/bubbletea&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// DevicesLoadedMsg signals that devices were loaded</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> DevicesLoadedMsg <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    Devices []model.Device
</span></span><span style=display:flex><span>    Err     <span style=color:#8be9fd>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Update handles messages</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m Model) <span style=color:#50fa7b>Update</span>(msg tea.Msg) (Model, tea.Cmd) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> msg <span style=color:#ff79c6>:=</span> msg.(<span style=color:#8be9fd;font-style:italic>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> tea.KeyMsg:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>switch</span> msg.<span style=color:#50fa7b>String</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;enter&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#6272a4>// Handle selection</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> m, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> DevicesLoadedMsg:
</span></span><span style=display:flex><span>        m.loading = <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> msg.Err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>            m.err = msg.Err
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> m, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        m.devices = msg.Devices
</span></span><span style=display:flex><span>        m.table.<span style=color:#50fa7b>SetRows</span>(<span style=color:#50fa7b>devicesToRows</span>(m.devices))
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> m, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> tea.WindowSizeMsg:
</span></span><span style=display:flex><span>        m.width = msg.Width
</span></span><span style=display:flex><span>        m.height = msg.Height
</span></span><span style=display:flex><span>        m.table.<span style=color:#50fa7b>SetWidth</span>(msg.Width)
</span></span><span style=display:flex><span>        m.table.<span style=color:#50fa7b>SetHeight</span>(msg.Height <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>4</span>) <span style=color:#6272a4>// Leave room for status</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> m, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>var</span> cmd tea.Cmd
</span></span><span style=display:flex><span>    m.table, cmd = m.table.<span style=color:#50fa7b>Update</span>(msg)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> m, cmd
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/tui/components/devicelist/view.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> devicelist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/charmbracelet/lipgloss&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// View renders the component</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m Model) <span style=color:#50fa7b>View</span>() <span style=color:#8be9fd>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> m.loading {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;Loading devices...&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> m.err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> lipgloss.<span style=color:#50fa7b>NewStyle</span>().
</span></span><span style=display:flex><span>            <span style=color:#50fa7b>Foreground</span>(lipgloss.<span style=color:#50fa7b>Color</span>(<span style=color:#f1fa8c>&#34;9&#34;</span>)).
</span></span><span style=display:flex><span>            <span style=color:#50fa7b>Render</span>(<span style=color:#f1fa8c>&#34;Error: &#34;</span> <span style=color:#ff79c6>+</span> m.err.<span style=color:#50fa7b>Error</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> m.table.<span style=color:#50fa7b>View</span>()
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=async-data-fetching>Async Data Fetching<a href=#async-data-fetching class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/tui/data/devices.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    tea <span style=color:#f1fa8c>&#34;github.com/charmbracelet/bubbletea&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/tj-smith47/shelly-cli/internal/shelly&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// FetchDevices returns a command that fetches devices</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>FetchDevices</span>() tea.Cmd {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>func</span>() tea.Msg {
</span></span><span style=display:flex><span>        svc <span style=color:#ff79c6>:=</span> shelly.<span style=color:#50fa7b>NewService</span>()
</span></span><span style=display:flex><span>        devices, err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>ListDevices</span>()
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> DevicesLoadedMsg{
</span></span><span style=display:flex><span>            Devices: devices,
</span></span><span style=display:flex><span>            Err:     err,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=multi-writer-output-pattern>Multi-Writer Output Pattern<a href=#multi-writer-output-pattern class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> Docker CLI (<code>docker build</code>, <code>docker compose up</code>)</p><p>Docker&rsquo;s build output shows multiple concurrent operations with per-line progress updates. Each layer/service gets its own line that updates in place. This pattern is ideal for:</p><ul><li>Batch device operations</li><li>Subnet scanning</li><li>Firmware updates across multiple devices</li><li>Scene activation</li></ul><h3 id=why-multi-writer>Why Multi-Writer?<a href=#why-multi-writer class=anchor aria-hidden=true>#</a></h3><ol><li><strong>Visual Clarity</strong>: See all operations at once</li><li><strong>Real-time Feedback</strong>: Each target shows its own status</li><li><strong>Professional UX</strong>: Modern CLI expectation for concurrent ops</li></ol><h3 id=implementation-with-lipgloss>Implementation with lipgloss<a href=#implementation-with-lipgloss class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/iostreams/multiwriter.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>package</span> iostreams
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/charmbracelet/lipgloss&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// MultiWriter manages multiple concurrent output lines</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> MultiWriter <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    mu      sync.Mutex
</span></span><span style=display:flex><span>    out     io.Writer
</span></span><span style=display:flex><span>    lines   <span style=color:#8be9fd;font-style:italic>map</span>[<span style=color:#8be9fd>string</span>]<span style=color:#ff79c6>*</span>Line
</span></span><span style=display:flex><span>    order   []<span style=color:#8be9fd>string</span>  <span style=color:#6272a4>// Preserve insertion order</span>
</span></span><span style=display:flex><span>    isTTY   <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Line represents a single output line that can be updated</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Line <span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>    ID      <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    Status  Status
</span></span><span style=display:flex><span>    Message <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>type</span> Status <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>const</span> (
</span></span><span style=display:flex><span>    StatusPending Status = <span style=color:#ff79c6>iota</span>
</span></span><span style=display:flex><span>    StatusRunning
</span></span><span style=display:flex><span>    StatusSuccess
</span></span><span style=display:flex><span>    StatusError
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// NewMultiWriter creates a multi-line writer</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewMultiWriter</span>(out io.Writer, isTTY <span style=color:#8be9fd>bool</span>) <span style=color:#ff79c6>*</span>MultiWriter {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>MultiWriter{
</span></span><span style=display:flex><span>        out:   out,
</span></span><span style=display:flex><span>        lines: <span style=color:#8be9fd;font-style:italic>make</span>(<span style=color:#8be9fd;font-style:italic>map</span>[<span style=color:#8be9fd>string</span>]<span style=color:#ff79c6>*</span>Line),
</span></span><span style=display:flex><span>        isTTY: isTTY,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// AddLine adds a new tracked line</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>AddLine</span>(id, message <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>    m.mu.<span style=color:#50fa7b>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defer</span> m.mu.<span style=color:#50fa7b>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m.lines[id] = <span style=color:#ff79c6>&amp;</span>Line{
</span></span><span style=display:flex><span>        ID:      id,
</span></span><span style=display:flex><span>        Status:  StatusPending,
</span></span><span style=display:flex><span>        Message: message,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    m.order = <span style=color:#8be9fd;font-style:italic>append</span>(m.order, id)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// UpdateLine updates an existing line</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>UpdateLine</span>(id <span style=color:#8be9fd>string</span>, status Status, message <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>    m.mu.<span style=color:#50fa7b>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defer</span> m.mu.<span style=color:#50fa7b>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> line, ok <span style=color:#ff79c6>:=</span> m.lines[id]; ok {
</span></span><span style=display:flex><span>        line.Status = status
</span></span><span style=display:flex><span>        line.Message = message
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m.<span style=color:#50fa7b>render</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// render redraws all lines (TTY only)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>render</span>() {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> !m.isTTY {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Move cursor up to start of our output</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(m.order) &gt; <span style=color:#bd93f9>1</span> {
</span></span><span style=display:flex><span>        fmt.<span style=color:#50fa7b>Fprintf</span>(m.out, <span style=color:#f1fa8c>&#34;\033[%dA&#34;</span>, <span style=color:#8be9fd;font-style:italic>len</span>(m.order)<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> _, id <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> m.order {
</span></span><span style=display:flex><span>        line <span style=color:#ff79c6>:=</span> m.lines[id]
</span></span><span style=display:flex><span>        fmt.<span style=color:#50fa7b>Fprintf</span>(m.out, <span style=color:#f1fa8c>&#34;\033[2K&#34;</span>) <span style=color:#6272a4>// Clear line</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        icon <span style=color:#ff79c6>:=</span> m.<span style=color:#50fa7b>statusIcon</span>(line.Status)
</span></span><span style=display:flex><span>        style <span style=color:#ff79c6>:=</span> m.<span style=color:#50fa7b>statusStyle</span>(line.Status)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        fmt.<span style=color:#50fa7b>Fprintf</span>(m.out, <span style=color:#f1fa8c>&#34;%s %s: %s\n&#34;</span>,
</span></span><span style=display:flex><span>            icon,
</span></span><span style=display:flex><span>            style.<span style=color:#50fa7b>Render</span>(line.ID),
</span></span><span style=display:flex><span>            line.Message,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>statusIcon</span>(s Status) <span style=color:#8be9fd>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> s {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusPending:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;â—‹&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusRunning:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;â—&#34;</span> <span style=color:#6272a4>// Or use spinner</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusSuccess:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;âœ“&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusError:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;âœ—&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;?&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>statusStyle</span>(s Status) lipgloss.Style {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> s {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusSuccess:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> lipgloss.<span style=color:#50fa7b>NewStyle</span>().<span style=color:#50fa7b>Foreground</span>(lipgloss.<span style=color:#50fa7b>Color</span>(<span style=color:#f1fa8c>&#34;2&#34;</span>)) <span style=color:#6272a4>// Green</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusError:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> lipgloss.<span style=color:#50fa7b>NewStyle</span>().<span style=color:#50fa7b>Foreground</span>(lipgloss.<span style=color:#50fa7b>Color</span>(<span style=color:#f1fa8c>&#34;1&#34;</span>)) <span style=color:#6272a4>// Red</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> StatusRunning:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> lipgloss.<span style=color:#50fa7b>NewStyle</span>().<span style=color:#50fa7b>Foreground</span>(lipgloss.<span style=color:#50fa7b>Color</span>(<span style=color:#f1fa8c>&#34;3&#34;</span>)) <span style=color:#6272a4>// Yellow</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> lipgloss.<span style=color:#50fa7b>NewStyle</span>().<span style=color:#50fa7b>Foreground</span>(lipgloss.<span style=color:#50fa7b>Color</span>(<span style=color:#f1fa8c>&#34;8&#34;</span>)) <span style=color:#6272a4>// Gray</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Finalize prints final state (for non-TTY or completion)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (m <span style=color:#ff79c6>*</span>MultiWriter) <span style=color:#50fa7b>Finalize</span>() {
</span></span><span style=display:flex><span>    m.mu.<span style=color:#50fa7b>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defer</span> m.mu.<span style=color:#50fa7b>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> !m.isTTY {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Non-TTY: print each line once at the end</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> _, id <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> m.order {
</span></span><span style=display:flex><span>            line <span style=color:#ff79c6>:=</span> m.lines[id]
</span></span><span style=display:flex><span>            icon <span style=color:#ff79c6>:=</span> m.<span style=color:#50fa7b>statusIcon</span>(line.Status)
</span></span><span style=display:flex><span>            fmt.<span style=color:#50fa7b>Fprintf</span>(m.out, <span style=color:#f1fa8c>&#34;%s %s: %s\n&#34;</span>, icon, line.ID, line.Message)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=usage-in-batch-operations>Usage in Batch Operations<a href=#usage-in-batch-operations class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/cmd/batch/on/on.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, ios <span style=color:#ff79c6>*</span>iostreams.IOStreams, targets []<span style=color:#8be9fd>string</span>, switchID <span style=color:#8be9fd>int</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    mw <span style=color:#ff79c6>:=</span> iostreams.<span style=color:#50fa7b>NewMultiWriter</span>(ios.Out, ios.<span style=color:#50fa7b>IsStdoutTTY</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Add all lines upfront</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>        mw.<span style=color:#50fa7b>AddLine</span>(target, <span style=color:#f1fa8c>&#34;pending&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    g, ctx <span style=color:#ff79c6>:=</span> errgroup.<span style=color:#50fa7b>WithContext</span>(ctx)
</span></span><span style=display:flex><span>    g.<span style=color:#50fa7b>SetLimit</span>(<span style=color:#bd93f9>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>        t <span style=color:#ff79c6>:=</span> target
</span></span><span style=display:flex><span>        g.<span style=color:#50fa7b>Go</span>(<span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>            mw.<span style=color:#50fa7b>UpdateLine</span>(t, iostreams.StatusRunning, <span style=color:#f1fa8c>&#34;turning on...&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            err <span style=color:#ff79c6>:=</span> svc.<span style=color:#50fa7b>SwitchOn</span>(ctx, t, switchID)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>                mw.<span style=color:#50fa7b>UpdateLine</span>(t, iostreams.StatusError, err.<span style=color:#50fa7b>Error</span>())
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span> <span style=color:#6272a4>// Don&#39;t fail whole batch</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            mw.<span style=color:#50fa7b>UpdateLine</span>(t, iostreams.StatusSuccess, <span style=color:#f1fa8c>&#34;on&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    g.<span style=color:#50fa7b>Wait</span>()
</span></span><span style=display:flex><span>    mw.<span style=color:#50fa7b>Finalize</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=example-output>Example Output<a href=#example-output class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>âœ“ living-room-light: on
</span></span><span style=display:flex><span>â— bedroom-switch: turning on...
</span></span><span style=display:flex><span>âœ“ kitchen-dimmer: on
</span></span><span style=display:flex><span>â—‹ garage-relay: pending
</span></span><span style=display:flex><span>âœ— basement-plug: connection timeout</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=opportunities-in-shelly-cli>Opportunities in shelly-cli<a href=#opportunities-in-shelly-cli class=anchor aria-hidden=true>#</a></h3><table><thead><tr><th>Command</th><th>Current</th><th>With Multi-Writer</th></tr></thead><tbody><tr><td><code>batch on/off/toggle</code></td><td>Sequential success/error messages</td><td>Per-device progress lines</td></tr><tr><td><code>discover scan</code></td><td>Single spinner</td><td>Per-IP status with progress</td></tr><tr><td><code>firmware update --all</code></td><td>Single spinner</td><td>Per-device update progress</td></tr><tr><td><code>scene activate</code></td><td>Sequential messages</td><td>Per-device activation status</td></tr><tr><td><code>provision bulk</code></td><td>Unknown</td><td>Per-device provisioning progress</td></tr></tbody></table><hr><h2 id=concurrency-patterns>Concurrency Patterns<a href=#concurrency-patterns class=anchor aria-hidden=true>#</a></h2><p><strong>Source:</strong> gh, kubectl, best practices</p><h3 id=waitgroupgo-go-125---fire-and-forget>WaitGroup.Go() (Go 1.25+) - Fire and Forget<a href=#waitgroupgo-go-125---fire-and-forget class=anchor aria-hidden=true>#</a></h3><p>Use <code>WaitGroup.Go()</code> when goroutines don&rsquo;t return errors or errors are handled via channels/shared state:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// WRONG (pre-Go 1.25 pattern - DO NOT USE)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> wg sync.WaitGroup
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>    wg.<span style=color:#50fa7b>Add</span>(<span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>go</span> <span style=color:#8be9fd;font-style:italic>func</span>(device <span style=color:#8be9fd>string</span>) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>defer</span> wg.<span style=color:#50fa7b>Done</span>()
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// work...</span>
</span></span><span style=display:flex><span>    }(target)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// CORRECT (Go 1.25+)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> wg sync.WaitGroup
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>    wg.<span style=color:#50fa7b>Go</span>(<span style=color:#8be9fd;font-style:italic>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// work with target</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>wg.<span style=color:#50fa7b>Wait</span>()</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=errgroup---error-propagation--concurrency-limits>errgroup - Error Propagation & Concurrency Limits<a href=#errgroup---error-propagation--concurrency-limits class=anchor aria-hidden=true>#</a></h3><p>Use <code>errgroup</code> when you need error handling, context cancellation on first error, or concurrency limits:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>g, ctx <span style=color:#ff79c6>:=</span> errgroup.<span style=color:#50fa7b>WithContext</span>(ctx)
</span></span><span style=display:flex><span>g.<span style=color:#50fa7b>SetLimit</span>(concurrent)
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> _, target <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> targets {
</span></span><span style=display:flex><span>    g.<span style=color:#50fa7b>Go</span>(<span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// work with target</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>:=</span> g.<span style=color:#50fa7b>Wait</span>(); err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> err
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><p><strong>When to use which:</strong></p><ul><li><code>WaitGroup.Go()</code>: Simple parallel work, errors handled separately (channels, mutex-protected state)</li><li><code>errgroup</code>: Need to propagate errors, cancel on first failure, or limit concurrency</li></ul><h3 id=context-propagation-1>Context Propagation<a href=#context-propagation-1 class=anchor aria-hidden=true>#</a></h3><p>Always pass context through the call chain:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// Get context from Cobra command</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> (cmd <span style=color:#ff79c6>*</span>cobra.Command) RunE: <span style=color:#8be9fd;font-style:italic>func</span>(cmd <span style=color:#ff79c6>*</span>cobra.Command, args []<span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ctx <span style=color:#ff79c6>:=</span> cmd.<span style=color:#50fa7b>Context</span>()  <span style=color:#6272a4>// Use this, NOT context.Background()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>run</span>(ctx, args[<span style=color:#bd93f9>0</span>])
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Pass context to all operations</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>run</span>(ctx context.Context, device <span style=color:#8be9fd>string</span>) <span style=color:#8be9fd>error</span> {
</span></span><span style=display:flex><span>    ctx, cancel <span style=color:#ff79c6>:=</span> context.<span style=color:#50fa7b>WithTimeout</span>(ctx, <span style=color:#bd93f9>30</span><span style=color:#ff79c6>*</span>time.Second)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>defer</span> <span style=color:#50fa7b>cancel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> client.<span style=color:#50fa7b>Call</span>(ctx, device, <span style=color:#f1fa8c>&#34;method&#34;</span>, <span style=color:#ff79c6>nil</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=testing-patterns>Testing Patterns<a href=#testing-patterns class=anchor aria-hidden=true>#</a></h2><h3 id=tui-testing-with-teatest>TUI Testing with teatest<a href=#tui-testing-with-teatest class=anchor aria-hidden=true>#</a></h3><p>For TUI components, use the experimental teatest package from Charm:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// Example TUI test using teatest</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// See: https://github.com/charmbracelet/x/tree/main/exp/teatest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tea <span style=color:#f1fa8c>&#34;github.com/charmbracelet/bubbletea&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;github.com/charmbracelet/x/exp/teatest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>TestDeviceListView</span>(t <span style=color:#ff79c6>*</span>testing.T) {
</span></span><span style=display:flex><span>    m <span style=color:#ff79c6>:=</span> devicelist.<span style=color:#50fa7b>New</span>()
</span></span><span style=display:flex><span>    tm <span style=color:#ff79c6>:=</span> teatest.<span style=color:#50fa7b>NewTestModel</span>(t, m, teatest.<span style=color:#50fa7b>WithInitialTermSize</span>(<span style=color:#bd93f9>80</span>, <span style=color:#bd93f9>24</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Wait for initial render</span>
</span></span><span style=display:flex><span>    teatest.<span style=color:#50fa7b>WaitFor</span>(t, tm.<span style=color:#50fa7b>Output</span>(), <span style=color:#8be9fd;font-style:italic>func</span>(bts []<span style=color:#8be9fd>byte</span>) <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> bytes.<span style=color:#50fa7b>Contains</span>(bts, []<span style=color:#8be9fd;font-style:italic>byte</span>(<span style=color:#f1fa8c>&#34;Loading&#34;</span>))
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Send devices loaded message</span>
</span></span><span style=display:flex><span>    tm.<span style=color:#50fa7b>Send</span>(devicelist.DevicesLoadedMsg{
</span></span><span style=display:flex><span>        Devices: []model.Device{{Name: <span style=color:#f1fa8c>&#34;test&#34;</span>, IP: <span style=color:#f1fa8c>&#34;192.168.1.1&#34;</span>}},
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Verify table renders</span>
</span></span><span style=display:flex><span>    teatest.<span style=color:#50fa7b>WaitFor</span>(t, tm.<span style=color:#50fa7b>Output</span>(), <span style=color:#8be9fd;font-style:italic>func</span>(bts []<span style=color:#8be9fd>byte</span>) <span style=color:#8be9fd>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> bytes.<span style=color:#50fa7b>Contains</span>(bts, []<span style=color:#8be9fd;font-style:italic>byte</span>(<span style=color:#f1fa8c>&#34;test&#34;</span>))
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Test keyboard navigation</span>
</span></span><span style=display:flex><span>    tm.<span style=color:#50fa7b>Send</span>(tea.KeyMsg{Type: tea.KeyDown})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Verify quit</span>
</span></span><span style=display:flex><span>    tm.<span style=color:#50fa7b>Send</span>(tea.KeyMsg{Type: tea.KeyRunes, Runes: []<span style=color:#8be9fd>rune</span>{<span style=color:#f1fa8c>&#39;q&#39;</span>}})
</span></span><span style=display:flex><span>    tm.<span style=color:#50fa7b>WaitFinished</span>(t, teatest.<span style=color:#50fa7b>WithFinalTimeout</span>(time.Second))
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=table-driven-tests>Table-Driven Tests<a href=#table-driven-tests class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>TestSwitchOn</span>(t <span style=color:#ff79c6>*</span>testing.T) {
</span></span><span style=display:flex><span>    tests <span style=color:#ff79c6>:=</span> []<span style=color:#8be9fd;font-style:italic>struct</span> {
</span></span><span style=display:flex><span>        name      <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>        device    <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>        switchID  <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span>        mockResp  <span style=color:#8be9fd>any</span>
</span></span><span style=display:flex><span>        mockErr   <span style=color:#8be9fd>error</span>
</span></span><span style=display:flex><span>        wantErr   <span style=color:#8be9fd>bool</span>
</span></span><span style=display:flex><span>        wantOut   <span style=color:#8be9fd>string</span>
</span></span><span style=display:flex><span>    }{
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            name:     <span style=color:#f1fa8c>&#34;success&#34;</span>,
</span></span><span style=display:flex><span>            device:   <span style=color:#f1fa8c>&#34;test-device&#34;</span>,
</span></span><span style=display:flex><span>            switchID: <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>            mockResp: <span style=color:#8be9fd;font-style:italic>map</span>[<span style=color:#8be9fd>string</span>]<span style=color:#8be9fd>any</span>{<span style=color:#f1fa8c>&#34;was_on&#34;</span>: <span style=color:#ff79c6>false</span>},
</span></span><span style=display:flex><span>            wantOut:  <span style=color:#f1fa8c>&#34;Switch 0 turned on\n&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            name:     <span style=color:#f1fa8c>&#34;device not found&#34;</span>,
</span></span><span style=display:flex><span>            device:   <span style=color:#f1fa8c>&#34;unknown&#34;</span>,
</span></span><span style=display:flex><span>            switchID: <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>            mockErr:  client.ErrDeviceNotFound,
</span></span><span style=display:flex><span>            wantErr:  <span style=color:#ff79c6>true</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> _, tt <span style=color:#ff79c6>:=</span> <span style=color:#ff79c6>range</span> tests {
</span></span><span style=display:flex><span>        t.<span style=color:#50fa7b>Run</span>(tt.name, <span style=color:#8be9fd;font-style:italic>func</span>(t <span style=color:#ff79c6>*</span>testing.T) {
</span></span><span style=display:flex><span>            ios, stdout, _ <span style=color:#ff79c6>:=</span> testutil.<span style=color:#50fa7b>NewTestIOStreams</span>()
</span></span><span style=display:flex><span>            f <span style=color:#ff79c6>:=</span> testutil.<span style=color:#50fa7b>NewTestFactory</span>(t)
</span></span><span style=display:flex><span>            f.MockClient.<span style=color:#50fa7b>SetResponse</span>(<span style=color:#f1fa8c>&#34;Switch.Set&#34;</span>, tt.mockResp, tt.mockErr)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            cmd <span style=color:#ff79c6>:=</span> on.<span style=color:#50fa7b>NewCommand</span>(f)
</span></span><span style=display:flex><span>            cmd.<span style=color:#50fa7b>SetArgs</span>([]<span style=color:#8be9fd>string</span>{tt.device, <span style=color:#f1fa8c>&#34;--id&#34;</span>, strconv.<span style=color:#50fa7b>Itoa</span>(tt.switchID)})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            err <span style=color:#ff79c6>:=</span> cmd.<span style=color:#50fa7b>Execute</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> tt.wantErr {
</span></span><span style=display:flex><span>                assert.<span style=color:#50fa7b>Error</span>(t, err)
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>return</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            assert.<span style=color:#50fa7b>NoError</span>(t, err)
</span></span><span style=display:flex><span>            assert.<span style=color:#50fa7b>Equal</span>(t, tt.wantOut, stdout.<span style=color:#50fa7b>String</span>())
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><h3 id=mock-factory>Mock Factory<a href=#mock-factory class=anchor aria-hidden=true>#</a></h3><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#6272a4>// internal/testutil/factory.go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>NewTestFactory</span>(t <span style=color:#ff79c6>*</span>testing.T) <span style=color:#ff79c6>*</span>cmdutil.Factory {
</span></span><span style=display:flex><span>    t.<span style=color:#50fa7b>Helper</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ios, _, _ <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewTestIOStreams</span>()
</span></span><span style=display:flex><span>    mockClient <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>NewMockClient</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>cmdutil.Factory{
</span></span><span style=display:flex><span>        IOStreams: <span style=color:#8be9fd;font-style:italic>func</span>() <span style=color:#ff79c6>*</span>iostreams.IOStreams {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> ios
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        Config: <span style=color:#8be9fd;font-style:italic>func</span>() (<span style=color:#ff79c6>*</span>config.Config, <span style=color:#8be9fd>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&amp;</span>config.Config{}, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        ShellyClient: <span style=color:#8be9fd;font-style:italic>func</span>(device <span style=color:#8be9fd>string</span>) (<span style=color:#ff79c6>*</span>client.Client, <span style=color:#8be9fd>error</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> mockClient, <span style=color:#ff79c6>nil</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div></figure></div><hr><h2 id=references>References<a href=#references class=anchor aria-hidden=true>#</a></h2><h3 id=cli-architecture>CLI Architecture<a href=#cli-architecture class=anchor aria-hidden=true>#</a></h3><ul><li><strong>gh CLI</strong>: <a href=https://github.com/cli/cli>https://github.com/cli/cli</a></li><li><strong>kubectl</strong>: <a href=https://github.com/kubernetes/kubectl>https://github.com/kubernetes/kubectl</a></li><li><strong>docker CLI</strong>: <a href=https://github.com/docker/cli>https://github.com/docker/cli</a></li><li><strong>jira-cli</strong>: <a href=https://github.com/ankitpokhrel/jira-cli>https://github.com/ankitpokhrel/jira-cli</a></li></ul><h3 id=tui-frameworks>TUI Frameworks<a href=#tui-frameworks class=anchor aria-hidden=true>#</a></h3><ul><li><strong>BubbleTea</strong>: <a href=https://github.com/charmbracelet/bubbletea>https://github.com/charmbracelet/bubbletea</a></li><li><strong>Bubbles</strong> (components): <a href=https://github.com/charmbracelet/bubbles>https://github.com/charmbracelet/bubbles</a></li><li><strong>Lipgloss</strong> (styling): <a href=https://github.com/charmbracelet/lipgloss>https://github.com/charmbracelet/lipgloss</a></li><li><strong>Glamour</strong> (markdown): <a href=https://github.com/charmbracelet/glamour>https://github.com/charmbracelet/glamour</a></li><li><strong>bubbletint</strong> (themes): <a href=https://github.com/lrstanley/bubbletint>https://github.com/lrstanley/bubbletint</a></li></ul><h3 id=tui-examples>TUI Examples<a href=#tui-examples class=anchor aria-hidden=true>#</a></h3><ul><li><strong>gh-dash</strong>: <a href=https://github.com/dlvhdr/gh-dash>https://github.com/dlvhdr/gh-dash</a></li><li><strong>k9s</strong>: <a href=https://github.com/derailed/k9s>https://github.com/derailed/k9s</a></li></ul><h3 id=testing>Testing<a href=#testing class=anchor aria-hidden=true>#</a></h3><ul><li><strong>teatest</strong> (TUI testing): <a href=https://github.com/charmbracelet/x/tree/main/exp/teatest>https://github.com/charmbracelet/x/tree/main/exp/teatest</a></li></ul><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=last-modified><a href=https://github.com/tj-smith47/shelly-cli/commit/afdc64b39e8bb3d7c35e4b66eb65f69542d79fc2><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Last updated on January 1, 2026</a></div><div class=edit-page><a href=https://github.com/tj-smith47/shelly-cli/blob/main/content//docs/contributing/development.md><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
Edit this page on GitHub</a></div></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/shelly-cli/docs/commands/shelly/ class="stretched-link text-reset text-decoration-none">shelly shelly</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/shelly-cli/docs/getting-started/installation/ class="stretched-link text-reset text-decoration-none">Installation</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/shelly-cli/docs/>Docs</a></li><li class=list-inline-item><a class=text-muted href=/shelly-cli/docs/commands/>Commands</a></li><li class=list-inline-item><a class=text-muted href=https://github.com/tj-smith47/shelly-cli>GitHub</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item></li></ul></div></div></div></footer><script async src=/shelly-cli/js/bootstrap.e4fcad8bd36ade79b65b328fc7b4e4cb8b08dc4771748ede1ef7f51143e7e80e.js integrity="sha256-5Pyti9Nq3nm2WzKPx7Tky4sI3EdxdI7eHvf1EUPn6A4="></script><script async src=/shelly-cli/js/app.19b73e0182301dd61c9211c2f6890104740e2eb9eb12fe4ba8d4f31435b22ed6.js integrity="sha256-Gbc+AYIwHdYckhHC9okBBHQOLrnrEv5LqNTzFDWyLtY="></script><script async src=/shelly-cli/js/flexsearch.113b7edaabeb04644a4b0da964854226f135a5e10d3341884f25bd0ad1ee4def.js integrity="sha256-ETt+2qvrBGRKSw2pZIVCJvE1peENM0GITyW9CtHuTe8="></script><script async src=/shelly-cli/js/search-modal.96e662d8f691fe25c859a3437074b485f2d7bed0bca612725028c6cf4322e2f2.js integrity="sha256-luZi2PaR/iXIWaNDcHS0hfLXvtC8phJyUCjGz0Mi4vI="></script></body></html>