{{/* VHS video shortcode - displays GIF or video with optional caption */}}

{{ $src := .Get "src" }}
{{ $alt := .Get "alt" | default "Terminal recording" }}
{{ $caption := .Get "caption" }}

<figure class="vhs-video">
  {{ if strings.HasSuffix $src ".gif" }}
    <img src="{{ $src }}" alt="{{ $alt }}" loading="lazy">
  {{ else }}
    <video autoplay loop muted playsinline>
      <source src="{{ $src }}" type="video/webm">
      <source src="{{ $src | replaceRE "\\.webm$" ".mp4" }}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  {{ end }}
  {{ with $caption }}
    <figcaption class="vhs-caption">{{ . }}</figcaption>
  {{ end }}
</figure>
